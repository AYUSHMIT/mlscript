
class Exp
//│ Defined class Exp

class Lit: { n: int } & Exp
class Add: { lhs: Exp; rhs: Exp } & Exp
//│ Defined class Lit
//│ Defined class Add

rec def eval e = case e of {
  | Lit -> e.n
  | Add -> eval e.lhs + eval e.rhs
  }
//│ eval: 'a -> int
//│   where
//│     'a <: (Add with {lhs: 'a, rhs: 'a}) | Lit
//│     = [Function: eval]

e = Add { lhs = Lit {n=1}; rhs = Lit {n=2} }
//│ e: Add with {lhs: Lit & {n: 1}, rhs: Lit & {n: 2}}
//│  = Add { lhs: Lit { n: 1 }, rhs: Lit { n: 2 } }

eval e
//│ res: int
//│    = 3


class Neg: { e: Exp } & Exp
//│ Defined class Neg

e2 = Neg { e }
//│ e2: Neg with {e: Add with {lhs: Lit & {n: 1}, rhs: Lit & {n: 2}}}
//│   = Neg { e: Add { lhs: Lit { n: 1 }, rhs: Lit { n: 2 } } }

e2.e.lhs.n
//│ res: 1
//│    = 1

:e
eval e2
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.40: 	eval e2
//│ ║        	^^^^^^^
//│ ╟── application of type `Neg & {e: ?e}` does not match type `Add & ?a | Lit & ?b`
//│ ║  l.31: 	e2 = Neg { e }
//│ ║        	     ^^^^^^^^^
//│ ╟── but it flows into reference with expected type `Add & ?c | Lit & ?d`
//│ ║  l.40: 	eval e2
//│ ║        	     ^^
//│ ╟── Note: constraint arises from reference:
//│ ║  l.10: 	rec def eval e = case e of {
//│ ╙──      	                      ^
//│ res: error | int
//│ Runtime error:
//│   Error: non-exhaustive case expression


def eval eval e = case e of {
  | Lit -> e.n
  | Add -> eval eval e.lhs + eval eval e.rhs
  }
//│ eval: ('a -> 'rhs -> int & 'a -> 'lhs -> int & 'a) -> ((Add with {lhs: 'lhs, rhs: 'rhs}) | (Lit with {n: 'n})) -> (int | 'n)
//│     = [Function: eval1]

:e
eval eval e
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?n, ?lhs, ?rhs, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i. ?a -> ?f -> (?n | ?i) <: (forall ?n, ?lhs, ?rhs, ?j, ?k, ?l, ?m, ?o, ?p, ?q, ?r, ?s. ?j -> ?p -> (?n | ?s)) -> ?t` exceeded recursion depth limit (400)
//│ ║  l.66: 	eval eval e
//│ ║        	^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α332
//│ ╟── while constraining:  α320  <!<  α332
//│ ╟── while constraining:  (α320,)  <!<  (α332,)
//│ ╟── while constraining:  (α332 -> (α339 -> (n341 | α343)))  <!<  ((α320,) -> α321)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α320,) -> α321)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α320
//│ ╟── while constraining:  α308  <!<  α320
//│ ╟── while constraining:  (α308,)  <!<  (α320,)
//│ ╟── while constraining:  (α320 -> (α327 -> (n329 | α331)))  <!<  ((α308,) -> α309)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α308,) -> α309)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α308
//│ ╟── while constraining:  α296  <!<  α308
//│ ╟── while constraining:  (α296,)  <!<  (α308,)
//│ ╟── while constraining:  (α308 -> (α315 -> (n317 | α319)))  <!<  ((α296,) -> α297)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α296,) -> α297)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α296
//│ ╟── while constraining:  α284  <!<  α296
//│ ╟── while constraining:  (α284,)  <!<  (α296,)
//│ ╟── while constraining:  (α296 -> (α303 -> (n305 | α307)))  <!<  ((α284,) -> α285)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α284,) -> α285)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α284
//│ ╟── while constraining:  α272  <!<  α284
//│ ╟── while constraining:  (α272,)  <!<  (α284,)
//│ ╟── while constraining:  (α284 -> (α291 -> (n293 | α295)))  <!<  ((α272,) -> α273)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α272,) -> α273)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α272
//│ ╟── while constraining:  α260  <!<  α272
//│ ╟── while constraining:  (α260,)  <!<  (α272,)
//│ ╟── while constraining:  (α272 -> (α279 -> (n281 | α283)))  <!<  ((α260,) -> α261)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α260,) -> α261)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α260
//│ ╟── while constraining:  α248  <!<  α260
//│ ╟── while constraining:  (α248,)  <!<  (α260,)
//│ ╟── while constraining:  (α260 -> (α267 -> (n269 | α271)))  <!<  ((α248,) -> α249)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α248,) -> α249)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α248
//│ ╟── while constraining:  α236  <!<  α248
//│ ╟── while constraining:  (α236,)  <!<  (α248,)
//│ ╟── while constraining:  (α248 -> (α255 -> (n257 | α259)))  <!<  ((α236,) -> α237)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α236,) -> α237)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α236
//│ ╟── while constraining:  α224  <!<  α236
//│ ╟── while constraining:  (α224,)  <!<  (α236,)
//│ ╟── while constraining:  (α236 -> (α243 -> (n245 | α247)))  <!<  ((α224,) -> α225)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α224,) -> α225)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α224
//│ ╟── while constraining:  α212  <!<  α224
//│ ╟── while constraining:  (α212,)  <!<  (α224,)
//│ ╟── while constraining:  (α224 -> (α231 -> (n233 | α235)))  <!<  ((α212,) -> α213)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α212,) -> α213)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α212
//│ ╟── while constraining:  α200  <!<  α212
//│ ╟── while constraining:  (α200,)  <!<  (α212,)
//│ ╟── while constraining:  (α212 -> (α219 -> (n221 | α223)))  <!<  ((α200,) -> α201)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α200,) -> α201)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α200
//│ ╟── while constraining:  α188  <!<  α200
//│ ╟── while constraining:  (α188,)  <!<  (α200,)
//│ ╟── while constraining:  (α200 -> (α207 -> (n209 | α211)))  <!<  ((α188,) -> α189)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α188,) -> α189)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α188
//│ ╟── while constraining:  (‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›,)  <!<  (α188,)
//│ ╟── while constraining:  (α188 -> (α195 -> (n197 | α199)))  <!<  ((‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›,) -> α187)
//│ ╙── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›,) -> α187)
//│ res: error
//│    = 3


def evalN evalN e = case e of {
  | Neg -> 0 - evalN evalN e.e
  | _ -> eval evalN e
  }
//│ evalN: ('a -> 'e -> int & 'a -> 'rhs -> int & 'a -> 'lhs -> int & 'a) -> ((Add with {lhs: 'lhs, rhs: 'rhs}) | (Lit with {n: 'n}) | (Neg with {e: 'e})) -> (int | 'n)
//│      = [Function: evalN]

:e
evalN eval e
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?e, ?rhs, ?lhs, ?n, ?a, ?b, ?c, ?d, ?f, ?g, ?h, ?i, ?j, ?k, ?l, ?m, ?o, ?p, ?q, ?r, ?s. ?a -> ?j -> (?q | ?r) <: (forall ?n0, ?lhs0, ?rhs0, ?t, ?u, ?v, ?w, ?x, ?y, ?z, ?a1, ?b1. ?t -> ?y -> (?n0 | ?b1)) -> ?c1` exceeded recursion depth limit (400)
//│ ║  l.146: 	evalN eval e
//│ ║         	^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α560
//│ ╟── while constraining:  α548  <!<  α560
//│ ╟── while constraining:  (α548,)  <!<  (α560,)
//│ ╟── while constraining:  (α560 -> (α567 -> (n569 | α571)))  <!<  ((α548,) -> α549)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α548,) -> α549)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α548
//│ ╟── while constraining:  α536  <!<  α548
//│ ╟── while constraining:  (α536,)  <!<  (α548,)
//│ ╟── while constraining:  (α548 -> (α555 -> (n557 | α559)))  <!<  ((α536,) -> α537)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α536,) -> α537)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α536
//│ ╟── while constraining:  α524  <!<  α536
//│ ╟── while constraining:  (α524,)  <!<  (α536,)
//│ ╟── while constraining:  (α536 -> (α543 -> (n545 | α547)))  <!<  ((α524,) -> α525)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α524,) -> α525)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α524
//│ ╟── while constraining:  α512  <!<  α524
//│ ╟── while constraining:  (α512,)  <!<  (α524,)
//│ ╟── while constraining:  (α524 -> (α531 -> (n533 | α535)))  <!<  ((α512,) -> α513)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α512,) -> α513)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α512
//│ ╟── while constraining:  α500  <!<  α512
//│ ╟── while constraining:  (α500,)  <!<  (α512,)
//│ ╟── while constraining:  (α512 -> (α519 -> (n521 | α523)))  <!<  ((α500,) -> α501)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α500,) -> α501)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α500
//│ ╟── while constraining:  α488  <!<  α500
//│ ╟── while constraining:  (α488,)  <!<  (α500,)
//│ ╟── while constraining:  (α500 -> (α507 -> (n509 | α511)))  <!<  ((α488,) -> α489)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α488,) -> α489)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α488
//│ ╟── while constraining:  α476  <!<  α488
//│ ╟── while constraining:  (α476,)  <!<  (α488,)
//│ ╟── while constraining:  (α488 -> (α495 -> (n497 | α499)))  <!<  ((α476,) -> α477)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α476,) -> α477)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α476
//│ ╟── while constraining:  α464  <!<  α476
//│ ╟── while constraining:  (α464,)  <!<  (α476,)
//│ ╟── while constraining:  (α476 -> (α483 -> (n485 | α487)))  <!<  ((α464,) -> α465)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α464,) -> α465)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α464
//│ ╟── while constraining:  α452  <!<  α464
//│ ╟── while constraining:  (α452,)  <!<  (α464,)
//│ ╟── while constraining:  (α464 -> (α471 -> (n473 | α475)))  <!<  ((α452,) -> α453)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α452,) -> α453)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α452
//│ ╟── while constraining:  α440  <!<  α452
//│ ╟── while constraining:  (α440,)  <!<  (α452,)
//│ ╟── while constraining:  (α452 -> (α459 -> (n461 | α463)))  <!<  ((α440,) -> α441)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α440,) -> α441)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α440
//│ ╟── while constraining:  α420  <!<  α440
//│ ╟── while constraining:  (α420,)  <!<  (α440,)
//│ ╟── while constraining:  (α440 -> (α447 -> (n449 | α451)))  <!<  ((α420,) -> α421)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α420,) -> α421)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α420
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α419
//│ ╟── while constraining:  (‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›,)  <!<  (α419,)
//│ ╟── while constraining:  (α419 -> (α430 -> (α437 | α438)))  <!<  ((‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›,) -> α418)
//│ ╙── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›,) -> α418)
//│ res: error
//│    = 3

:e
evalN eval e2
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?e, ?rhs, ?lhs, ?n, ?a, ?b, ?c, ?d, ?f, ?g, ?h, ?i, ?j, ?k, ?l, ?m, ?o, ?p, ?q, ?r, ?s. ?a -> ?j -> (?q | ?r) <: (forall ?n0, ?lhs0, ?rhs0, ?t, ?u, ?v, ?w, ?x, ?y, ?z, ?a1, ?b1. ?t -> ?y -> (?n0 | ?b1)) -> ?c1` exceeded recursion depth limit (400)
//│ ║  l.214: 	evalN eval e2
//│ ║         	^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α742
//│ ╟── while constraining:  α730  <!<  α742
//│ ╟── while constraining:  (α730,)  <!<  (α742,)
//│ ╟── while constraining:  (α742 -> (α749 -> (n751 | α753)))  <!<  ((α730,) -> α731)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α730,) -> α731)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α730
//│ ╟── while constraining:  α718  <!<  α730
//│ ╟── while constraining:  (α718,)  <!<  (α730,)
//│ ╟── while constraining:  (α730 -> (α737 -> (n739 | α741)))  <!<  ((α718,) -> α719)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α718,) -> α719)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α718
//│ ╟── while constraining:  α706  <!<  α718
//│ ╟── while constraining:  (α706,)  <!<  (α718,)
//│ ╟── while constraining:  (α718 -> (α725 -> (n727 | α729)))  <!<  ((α706,) -> α707)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α706,) -> α707)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α706
//│ ╟── while constraining:  α694  <!<  α706
//│ ╟── while constraining:  (α694,)  <!<  (α706,)
//│ ╟── while constraining:  (α706 -> (α713 -> (n715 | α717)))  <!<  ((α694,) -> α695)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α694,) -> α695)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α694
//│ ╟── while constraining:  α682  <!<  α694
//│ ╟── while constraining:  (α682,)  <!<  (α694,)
//│ ╟── while constraining:  (α694 -> (α701 -> (n703 | α705)))  <!<  ((α682,) -> α683)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α682,) -> α683)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α682
//│ ╟── while constraining:  α670  <!<  α682
//│ ╟── while constraining:  (α670,)  <!<  (α682,)
//│ ╟── while constraining:  (α682 -> (α689 -> (n691 | α693)))  <!<  ((α670,) -> α671)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α670,) -> α671)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α670
//│ ╟── while constraining:  α658  <!<  α670
//│ ╟── while constraining:  (α658,)  <!<  (α670,)
//│ ╟── while constraining:  (α670 -> (α677 -> (n679 | α681)))  <!<  ((α658,) -> α659)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α658,) -> α659)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α658
//│ ╟── while constraining:  α646  <!<  α658
//│ ╟── while constraining:  (α646,)  <!<  (α658,)
//│ ╟── while constraining:  (α658 -> (α665 -> (n667 | α669)))  <!<  ((α646,) -> α647)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α646,) -> α647)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α646
//│ ╟── while constraining:  α634  <!<  α646
//│ ╟── while constraining:  (α634,)  <!<  (α646,)
//│ ╟── while constraining:  (α646 -> (α653 -> (n655 | α657)))  <!<  ((α634,) -> α635)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α634,) -> α635)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α634
//│ ╟── while constraining:  α622  <!<  α634
//│ ╟── while constraining:  (α622,)  <!<  (α634,)
//│ ╟── while constraining:  (α634 -> (α641 -> (n643 | α645)))  <!<  ((α622,) -> α623)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α622,) -> α623)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α622
//│ ╟── while constraining:  α602  <!<  α622
//│ ╟── while constraining:  (α602,)  <!<  (α622,)
//│ ╟── while constraining:  (α622 -> (α629 -> (n631 | α633)))  <!<  ((α602,) -> α603)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  ((α602,) -> α603)
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α602
//│ ╟── while constraining:  ‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›  <!<  α601
//│ ╟── while constraining:  (‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›,)  <!<  (α601,)
//│ ╟── while constraining:  (α601 -> (α612 -> (α619 | α620)))  <!<  ((‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›,) -> α600)
//│ ╙── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((‹∀ 0. (α154' -> (α155' -> (n157' | α166')))›,) -> α600)
//│ res: error
//│    = -3

:e
ev = evalN evalN
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?e, ?rhs, ?lhs, ?n, ?a, ?b, ?c, ?d, ?f, ?g, ?h, ?i, ?j, ?k, ?l, ?m, ?o, ?p, ?q, ?r, ?s. ?a -> ?j -> (?q | ?r) <: (forall ?e, ?rhs, ?lhs, ?n, ?t, ?u, ?v, ?w, ?x, ?y, ?z, ?a1, ?b1, ?c1, ?d1, ?e1, ?f1, ?g1, ?h1, ?i1, ?j1. ?t -> ?b1 -> (?h1 | ?i1)) -> ?k1` exceeded recursion depth limit (400)
//│ ║  l.282: 	ev = evalN evalN
//│ ║         	     ^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α951'
//│ ╟── while constraining:  α931'  <!<  α951'
//│ ╟── while constraining:  (α931',)  <!<  (α951',)
//│ ╟── while constraining:  (α951' -> (α962' -> (α969' | α970')))  <!<  ((α931',) -> α932')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((α931',) -> α932')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α931'
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α930'
//│ ╟── while constraining:  α910'  <!<  α930'
//│ ╟── while constraining:  (α910',)  <!<  (α930',)
//│ ╟── while constraining:  (α930' -> (α941' -> (α948' | α949')))  <!<  ((α910',) -> α911')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((α910',) -> α911')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α910'
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α909'
//│ ╟── while constraining:  α889'  <!<  α909'
//│ ╟── while constraining:  (α889',)  <!<  (α909',)
//│ ╟── while constraining:  (α909' -> (α920' -> (α927' | α928')))  <!<  ((α889',) -> α890')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((α889',) -> α890')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α889'
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α888'
//│ ╟── while constraining:  α868'  <!<  α888'
//│ ╟── while constraining:  (α868',)  <!<  (α888',)
//│ ╟── while constraining:  (α888' -> (α899' -> (α906' | α907')))  <!<  ((α868',) -> α869')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((α868',) -> α869')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α868'
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α867'
//│ ╟── while constraining:  α847'  <!<  α867'
//│ ╟── while constraining:  (α847',)  <!<  (α867',)
//│ ╟── while constraining:  (α867' -> (α878' -> (α885' | α886')))  <!<  ((α847',) -> α848')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((α847',) -> α848')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α847'
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α846'
//│ ╟── while constraining:  α826'  <!<  α846'
//│ ╟── while constraining:  (α826',)  <!<  (α846',)
//│ ╟── while constraining:  (α846' -> (α857' -> (α864' | α865')))  <!<  ((α826',) -> α827')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((α826',) -> α827')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α826'
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α825'
//│ ╟── while constraining:  α805'  <!<  α825'
//│ ╟── while constraining:  (α805',)  <!<  (α825',)
//│ ╟── while constraining:  (α825' -> (α836' -> (α843' | α844')))  <!<  ((α805',) -> α806')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((α805',) -> α806')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α805'
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α804'
//│ ╟── while constraining:  α784'  <!<  α804'
//│ ╟── while constraining:  (α784',)  <!<  (α804',)
//│ ╟── while constraining:  (α804' -> (α815' -> (α822' | α823')))  <!<  ((α784',) -> α785')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((α784',) -> α785')
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α784'
//│ ╟── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  α783'
//│ ╟── while constraining:  (‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›,)  <!<  (α783',)
//│ ╟── while constraining:  (α783' -> (α794' -> (α801' | α802')))  <!<  ((‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›,) -> α782')
//│ ╙── while constraining:  ‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›  <!<  ((‹∀ 0. (α364' -> (α365' -> (α371' | α386')))›,) -> α782')
//│ ev: error
//│   = [Function (anonymous)]

(ev e, ev e2)
//│ res: (error, error,)
//│    = [ 3, -3 ]


e3 = Add { lhs = Neg { e = Lit {n=1} }; rhs = Lit {n=2} }
//│ e3: Add with {lhs: Neg with {e: Lit & {n: 1}}, rhs: Lit & {n: 2}}
//│   = Add { lhs: Neg { e: Lit { n: 1 } }, rhs: Lit { n: 2 } }

ev e3
//│ res: error
//│    = 1


// * With a continuation, to make `evalN` not need to mention `eval` at all:

def evalN evalN k e = case e of {
  | Neg -> 0 - evalN evalN k e.e
  | _ -> k e
  }
//│ evalN: ('a -> 'b -> 'e -> int & 'a) -> ('c -> 'd & 'b) -> ((Neg with {e: 'e}) | 'c & ~neg) -> (int | 'd)
//│      = [Function: evalN1]


:e
def evalComposed evalComposed = evalN evalN (fun e -> eval evalComposed e)
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?e, ?a, ?b, ?c, ?d, ?f, ?g, ?h, ?i, ?j, ?k. ?c -> ?f -> ?i -> (?b | ?k) <: (forall ?e, ?a, ?b, ?l, ?m, ?n, ?o, ?p, ?q, ?r, ?s. ?l -> ?n -> ?q -> (?b | ?s)) -> ?t` exceeded recursion depth limit (400)
//│ ║  l.366: 	def evalComposed evalComposed = evalN evalN (fun e -> eval evalComposed e)
//│ ║         	                                ^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1198'
//│ ╟── while constraining:  α1187'  <!<  α1198'
//│ ╟── while constraining:  (α1187',)  <!<  (α1198',)
//│ ╟── while constraining:  (α1198' -> (α1200' -> (α1206' -> (α1208' | α1202'))))  <!<  ((α1187',) -> α1188')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1187',) -> α1188')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1187'
//│ ╟── while constraining:  α1176'  <!<  α1187'
//│ ╟── while constraining:  (α1176',)  <!<  (α1187',)
//│ ╟── while constraining:  (α1187' -> (α1189' -> (α1195' -> (α1197' | α1191'))))  <!<  ((α1176',) -> α1177')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1176',) -> α1177')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1176'
//│ ╟── while constraining:  α1165'  <!<  α1176'
//│ ╟── while constraining:  (α1165',)  <!<  (α1176',)
//│ ╟── while constraining:  (α1176' -> (α1178' -> (α1184' -> (α1186' | α1180'))))  <!<  ((α1165',) -> α1166')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1165',) -> α1166')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1165'
//│ ╟── while constraining:  α1154'  <!<  α1165'
//│ ╟── while constraining:  (α1154',)  <!<  (α1165',)
//│ ╟── while constraining:  (α1165' -> (α1167' -> (α1173' -> (α1175' | α1169'))))  <!<  ((α1154',) -> α1155')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1154',) -> α1155')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1154'
//│ ╟── while constraining:  α1143'  <!<  α1154'
//│ ╟── while constraining:  (α1143',)  <!<  (α1154',)
//│ ╟── while constraining:  (α1154' -> (α1156' -> (α1162' -> (α1164' | α1158'))))  <!<  ((α1143',) -> α1144')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1143',) -> α1144')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1143'
//│ ╟── while constraining:  α1132'  <!<  α1143'
//│ ╟── while constraining:  (α1132',)  <!<  (α1143',)
//│ ╟── while constraining:  (α1143' -> (α1145' -> (α1151' -> (α1153' | α1147'))))  <!<  ((α1132',) -> α1133')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1132',) -> α1133')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1132'
//│ ╟── while constraining:  α1121'  <!<  α1132'
//│ ╟── while constraining:  (α1121',)  <!<  (α1132',)
//│ ╟── while constraining:  (α1132' -> (α1134' -> (α1140' -> (α1142' | α1136'))))  <!<  ((α1121',) -> α1122')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1121',) -> α1122')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1121'
//│ ╟── while constraining:  α1110'  <!<  α1121'
//│ ╟── while constraining:  (α1110',)  <!<  (α1121',)
//│ ╟── while constraining:  (α1121' -> (α1123' -> (α1129' -> (α1131' | α1125'))))  <!<  ((α1110',) -> α1111')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1110',) -> α1111')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1110'
//│ ╟── while constraining:  α1099'  <!<  α1110'
//│ ╟── while constraining:  (α1099',)  <!<  (α1110',)
//│ ╟── while constraining:  (α1110' -> (α1112' -> (α1118' -> (α1120' | α1114'))))  <!<  ((α1099',) -> α1100')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1099',) -> α1100')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1099'
//│ ╟── while constraining:  α1088'  <!<  α1099'
//│ ╟── while constraining:  (α1088',)  <!<  (α1099',)
//│ ╟── while constraining:  (α1099' -> (α1101' -> (α1107' -> (α1109' | α1103'))))  <!<  ((α1088',) -> α1089')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1088',) -> α1089')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1088'
//│ ╟── while constraining:  α1077'  <!<  α1088'
//│ ╟── while constraining:  (α1077',)  <!<  (α1088',)
//│ ╟── while constraining:  (α1088' -> (α1090' -> (α1096' -> (α1098' | α1092'))))  <!<  ((α1077',) -> α1078')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1077',) -> α1078')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1077'
//│ ╟── while constraining:  α1066'  <!<  α1077'
//│ ╟── while constraining:  (α1066',)  <!<  (α1077',)
//│ ╟── while constraining:  (α1077' -> (α1079' -> (α1085' -> (α1087' | α1081'))))  <!<  ((α1066',) -> α1067')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1066',) -> α1067')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1066'
//│ ╟── while constraining:  (‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›,)  <!<  (α1066',)
//│ ╟── while constraining:  (α1066' -> (α1068' -> (α1074' -> (α1076' | α1070'))))  <!<  ((‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›,) -> α1065')
//│ ╙── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›,) -> α1065')
//│ evalComposed: ('a -> nothing -> int & 'a) -> error
//│             = [Function: evalComposed]

:e
def evalComposed evalComposed = evalN evalN (eval evalComposed)
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?e, ?a, ?b, ?c, ?d, ?f, ?g, ?h, ?i, ?j, ?k. ?c -> ?f -> ?i -> (?b | ?k) <: (forall ?e, ?a, ?b, ?l, ?m, ?n, ?o, ?p, ?q, ?r, ?s. ?l -> ?n -> ?q -> (?b | ?s)) -> ?t` exceeded recursion depth limit (400)
//│ ║  l.438: 	def evalComposed evalComposed = evalN evalN (eval evalComposed)
//│ ║         	                                ^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1395'
//│ ╟── while constraining:  α1384'  <!<  α1395'
//│ ╟── while constraining:  (α1384',)  <!<  (α1395',)
//│ ╟── while constraining:  (α1395' -> (α1397' -> (α1403' -> (α1405' | α1399'))))  <!<  ((α1384',) -> α1385')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1384',) -> α1385')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1384'
//│ ╟── while constraining:  α1373'  <!<  α1384'
//│ ╟── while constraining:  (α1373',)  <!<  (α1384',)
//│ ╟── while constraining:  (α1384' -> (α1386' -> (α1392' -> (α1394' | α1388'))))  <!<  ((α1373',) -> α1374')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1373',) -> α1374')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1373'
//│ ╟── while constraining:  α1362'  <!<  α1373'
//│ ╟── while constraining:  (α1362',)  <!<  (α1373',)
//│ ╟── while constraining:  (α1373' -> (α1375' -> (α1381' -> (α1383' | α1377'))))  <!<  ((α1362',) -> α1363')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1362',) -> α1363')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1362'
//│ ╟── while constraining:  α1351'  <!<  α1362'
//│ ╟── while constraining:  (α1351',)  <!<  (α1362',)
//│ ╟── while constraining:  (α1362' -> (α1364' -> (α1370' -> (α1372' | α1366'))))  <!<  ((α1351',) -> α1352')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1351',) -> α1352')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1351'
//│ ╟── while constraining:  α1340'  <!<  α1351'
//│ ╟── while constraining:  (α1340',)  <!<  (α1351',)
//│ ╟── while constraining:  (α1351' -> (α1353' -> (α1359' -> (α1361' | α1355'))))  <!<  ((α1340',) -> α1341')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1340',) -> α1341')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1340'
//│ ╟── while constraining:  α1329'  <!<  α1340'
//│ ╟── while constraining:  (α1329',)  <!<  (α1340',)
//│ ╟── while constraining:  (α1340' -> (α1342' -> (α1348' -> (α1350' | α1344'))))  <!<  ((α1329',) -> α1330')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1329',) -> α1330')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1329'
//│ ╟── while constraining:  α1318'  <!<  α1329'
//│ ╟── while constraining:  (α1318',)  <!<  (α1329',)
//│ ╟── while constraining:  (α1329' -> (α1331' -> (α1337' -> (α1339' | α1333'))))  <!<  ((α1318',) -> α1319')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1318',) -> α1319')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1318'
//│ ╟── while constraining:  α1307'  <!<  α1318'
//│ ╟── while constraining:  (α1307',)  <!<  (α1318',)
//│ ╟── while constraining:  (α1318' -> (α1320' -> (α1326' -> (α1328' | α1322'))))  <!<  ((α1307',) -> α1308')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1307',) -> α1308')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1307'
//│ ╟── while constraining:  α1296'  <!<  α1307'
//│ ╟── while constraining:  (α1296',)  <!<  (α1307',)
//│ ╟── while constraining:  (α1307' -> (α1309' -> (α1315' -> (α1317' | α1311'))))  <!<  ((α1296',) -> α1297')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1296',) -> α1297')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1296'
//│ ╟── while constraining:  α1285'  <!<  α1296'
//│ ╟── while constraining:  (α1285',)  <!<  (α1296',)
//│ ╟── while constraining:  (α1296' -> (α1298' -> (α1304' -> (α1306' | α1300'))))  <!<  ((α1285',) -> α1286')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1285',) -> α1286')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1285'
//│ ╟── while constraining:  α1274'  <!<  α1285'
//│ ╟── while constraining:  (α1274',)  <!<  (α1285',)
//│ ╟── while constraining:  (α1285' -> (α1287' -> (α1293' -> (α1295' | α1289'))))  <!<  ((α1274',) -> α1275')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1274',) -> α1275')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1274'
//│ ╟── while constraining:  α1263'  <!<  α1274'
//│ ╟── while constraining:  (α1263',)  <!<  (α1274',)
//│ ╟── while constraining:  (α1274' -> (α1276' -> (α1282' -> (α1284' | α1278'))))  <!<  ((α1263',) -> α1264')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((α1263',) -> α1264')
//│ ╟── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  α1263'
//│ ╟── while constraining:  (‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›,)  <!<  (α1263',)
//│ ╟── while constraining:  (α1263' -> (α1265' -> (α1271' -> (α1273' | α1267'))))  <!<  ((‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›,) -> α1262')
//│ ╙── while constraining:  ‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›  <!<  ((‹∀ 0. (α1031' -> (α1032' -> (α1033' -> (α1040' | α1042'))))›,) -> α1262')
//│ evalComposed: ('a -> nothing -> int & 'a) -> error
//│             = [Function: evalComposed1]


:e
// * NOTE: This inferred type is a good example
// *    of the need for an algorithm to tie recursive TV knots and inline the rest;
// *    once we inline, `b` we should get the expected simplified recursive type.
ev2 = evalComposed evalComposed
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?rhs, ?lhs, ?a, ?b, ?c, ?d, ?e, ?f, ?g. ?a -> ?g <: (forall ?rhs, ?lhs, ?h, ?i, ?j, ?k, ?l, ?m, ?n. ?h -> ?n) -> ?o` exceeded recursion depth limit (400)
//│ ║  l.514: 	ev2 = evalComposed evalComposed
//│ ║         	      ^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1520'
//│ ╟── while constraining:  α1512'  <!<  α1520'
//│ ╟── while constraining:  (α1512',)  <!<  (α1520',)
//│ ╟── while constraining:  (α1520' -> α1528')  <!<  ((α1512',) -> α1513')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  ((α1512',) -> α1513')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1512'
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1511'
//│ ╟── while constraining:  α1503'  <!<  α1511'
//│ ╟── while constraining:  (α1503',)  <!<  (α1511',)
//│ ╟── while constraining:  (α1511' -> α1519')  <!<  ((α1503',) -> α1504')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  ((α1503',) -> α1504')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1503'
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1502'
//│ ╟── while constraining:  α1494'  <!<  α1502'
//│ ╟── while constraining:  (α1494',)  <!<  (α1502',)
//│ ╟── while constraining:  (α1502' -> α1510')  <!<  ((α1494',) -> α1495')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  ((α1494',) -> α1495')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1494'
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1493'
//│ ╟── while constraining:  α1485'  <!<  α1493'
//│ ╟── while constraining:  (α1485',)  <!<  (α1493',)
//│ ╟── while constraining:  (α1493' -> α1501')  <!<  ((α1485',) -> α1486')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  ((α1485',) -> α1486')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1485'
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1484'
//│ ╟── while constraining:  α1476'  <!<  α1484'
//│ ╟── while constraining:  (α1476',)  <!<  (α1484',)
//│ ╟── while constraining:  (α1484' -> α1492')  <!<  ((α1476',) -> α1477')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  ((α1476',) -> α1477')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1476'
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1475'
//│ ╟── while constraining:  α1467'  <!<  α1475'
//│ ╟── while constraining:  (α1467',)  <!<  (α1475',)
//│ ╟── while constraining:  (α1475' -> α1483')  <!<  ((α1467',) -> α1468')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  ((α1467',) -> α1468')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1467'
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1466'
//│ ╟── while constraining:  α1458'  <!<  α1466'
//│ ╟── while constraining:  (α1458',)  <!<  (α1466',)
//│ ╟── while constraining:  (α1466' -> α1474')  <!<  ((α1458',) -> α1459')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  ((α1458',) -> α1459')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1458'
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1457'
//│ ╟── while constraining:  α1449'  <!<  α1457'
//│ ╟── while constraining:  (α1449',)  <!<  (α1457',)
//│ ╟── while constraining:  (α1457' -> α1465')  <!<  ((α1449',) -> α1450')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  ((α1449',) -> α1450')
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1449'
//│ ╟── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  α1448'
//│ ╟── while constraining:  (‹∀ 0. (α1261' -> α1435')›,)  <!<  (α1448',)
//│ ╟── while constraining:  (α1448' -> α1456')  <!<  ((‹∀ 0. (α1261' -> α1435')›,) -> α1447')
//│ ╙── while constraining:  ‹∀ 0. (α1261' -> α1435')›  <!<  ((‹∀ 0. (α1261' -> α1435')›,) -> α1447')
//│ ev2: error
//│    = [Function (anonymous)]

ev2 e3
//│ res: error
//│    = 1


def ev2_ty: (Add & { lhs: 'a; rhs: 'a } | Lit | Neg & { e: 'a } as 'a) -> int
//│ ev2_ty: 'a -> int
//│   where
//│     'a <: (Add with {lhs: 'a, rhs: 'a}) | Lit | (Neg with {e: 'a})
//│       = <missing implementation>

ev2_ty = ev2
//│ error
//│   <:  ev2_ty:
//│ 'a -> int
//│   where
//│     'a <: (Add with {lhs: 'a, rhs: 'a}) | Lit | (Neg with {e: 'a})
//│       = [Function (anonymous)]

