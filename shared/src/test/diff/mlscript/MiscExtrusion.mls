:NoJS

class Expr[A]
  method Inv: A -> A
//│ Defined class Expr[=A]
//│ Declared Expr.Inv: Expr['A] -> 'A -> 'A

def asExpr: Expr['a] -> Expr['a]
//│ asExpr: Expr['a] -> Expr['a]

def alsoPrintSizeSimple f =
  let rec nested expr =
    f expr
  in nested
//│ alsoPrintSizeSimple: ('a -> 'b) -> (forall 'c, 'd, 'nested. ('a & 'c) -> ('d | 'b) | 'nested)

def alsoPrintSizeSimple f =
  let rec nested expr =
    f (asExpr expr)
  in nested
//│ alsoPrintSizeSimple: (Expr[in 'a out 'a | 'a0] -> 'b) -> (forall 'a1, 'c, 'd, 'nested. (Expr['a1] & 'c) -> ('d | 'b) | 'nested)
//│   where
//│     'a1 :> 'a
//│         <: 'a0

def alsoPrintSizeSimple f =
  let rec nested expr =
    asExpr (f (asExpr expr))
  in nested
//│ alsoPrintSizeSimple: (Expr[in 'a out 'a | 'a0] -> Expr[in 'a1 out 'a1 | 'a2]) -> (forall 'nested, 'b, 'a3, 'a4, 'c. (Expr['a3] & 'b) -> (Expr['a4] | 'c) | 'nested)
//│   where
//│     'a4 :> 'a1
//│         <: 'a2
//│     'a3 :> 'a
//│         <: 'a0

def alsoPrintSizeSimple f =
  let rec nested expr =
    f (asExpr expr) nested
  in nested
//│ alsoPrintSizeSimple: (Expr[in 'a out 'a | 'a0] -> (Expr[in 'a0 & 'a1 out 'a | 'a1 | 'a2] -> 'b) -> 'b) -> (forall 'a3, 'c, 'd, 'nested. (Expr['a3] & 'c) -> ('d | 'b) | 'nested)
//│   where
//│     'a3 :> 'a | 'a1
//│         <: 'a0 & 'a2


