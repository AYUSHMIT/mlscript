
// From SuperType tests

def True = true
//│ True: true
//│     = true

def inc: int -> int
//│ inc: int -> int
//│    = <missing implementation>

test f =
  let r = fun x -> fun g -> (g x, )
  in (r 0 inc, r True not)
//│ test: anything -> ((int,), (bool,),)
//│     = <no result>
//│       inc is not implemented

// * Precise type:
test f = (f 0, f True)
//│ test: (true -> 'a & 0 -> 'b) -> ('b, 'a,)
//│     = [Function: test]

// * Imprecise type (notice the `(0 | true)`):
// * Note: With inferred first-class constraints and generalized curried functions,
// *  this approximation be avoided (see below).
test f =
  let r x = f x
  in (r 0, r True)
//│ test: (nothing -> anything) -> (nothing, nothing,)
//│     = [Function: test1]

// Same example, a little elaborated
test f =
  let r = fun x -> fun g -> (g x, f x)
  in (r 0 inc, r True not)
//│ test: (nothing -> anything) -> ((int, nothing,), (bool, nothing,),)
//│     = <no result>
//│       inc is not implemented


:GeneralizeCurriedFunctions

test f =
  let r x = f x
  in (r 0, r True)
//│ test: (nothing -> 'a & 'a) -> (forall 'a. ((forall 'a, 'b. ('b
//│   where
//│     'a <: 0 -> 'b), forall 'a, 'c. ('c
//│   where
//│     'a <: true -> 'c),)
//│   where
//│     'a <: nothing -> 'a))
//│     = [Function: test2]

:e
(test id)._1 + 1
not (test id)._1 + 1
//│ res: int
//│    = NaN
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.58: 	not (test id)._1 + 1
//│ ║        	^^^^^^^^^^^^^^^^
//│ ╟── integer literal of type `0` is not an instance of type `bool`
//│ ║  l.46: 	  in (r 0, r True)
//│ ║        	        ^
//│ ╟── but it flows into field selection with expected type `bool`
//│ ║  l.58: 	not (test id)._1 + 1
//│ ╙──      	    ^^^^^^^^^^^^
//│ res: int
//│    = 2

// * Even works with recursive definition because the constrained type is strictly local to the body!
rec def test f =
  let r x = f x
  in (r 0, r True)
//│ test: (nothing -> 'a & 'a) -> (forall 'a, 'b. ('b
//│   where
//│     'a <: 0 -> 'b), forall 'a, 'c. ('c
//│   where
//│     'a <: true -> 'c),)
//│     = [Function: test3]
