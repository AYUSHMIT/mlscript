
class Expr
class Lit: Expr & { val: int }
class Add: Expr & { lhs: Expr; rhs: Expr }
//│ Defined class Expr
//│ Defined class Lit
//│ Defined class Add

rec def eval x = case x of {
  Lit -> x.val
  | Add -> eval x.lhs + eval x.rhs
  }
//│ eval: 'a -> int
//│   where
//│     'a <: (Add with {lhs: 'a, rhs: 'a}) | Lit
//│     = [Function: eval]

def eval eval x = case x of {
  Lit -> x.val
  | Add -> eval eval x.lhs + eval eval x.rhs
  }
//│ eval: ('a -> 'rhs -> int & 'a -> 'lhs -> int & 'a) -> ((Add with {lhs: 'lhs, rhs: 'rhs}) | (Lit with {val: 'val})) -> (int | 'val)
//│     = [Function: eval1]

:e
eval eval
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?val, ?lhs, ?rhs, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i. ?a -> ?f -> (?val | ?i) <: (forall ?val, ?lhs, ?rhs, ?j, ?k, ?l, ?m, ?n, ?o, ?p, ?q, ?r. ?j -> ?o -> (?val | ?r)) -> ?s` exceeded recursion depth limit (400)
//│ ║  l.26: 	eval eval
//│ ║        	^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α226
//│ ╟── while constraining:  α214  <!<  α226
//│ ╟── while constraining:  (α214,)  <!<  (α226,)
//│ ╟── while constraining:  (α226 -> (α233 -> (val235 | α237)))  <!<  ((α214,) -> α215)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α214,) -> α215)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α214
//│ ╟── while constraining:  α202  <!<  α214
//│ ╟── while constraining:  (α202,)  <!<  (α214,)
//│ ╟── while constraining:  (α214 -> (α221 -> (val223 | α225)))  <!<  ((α202,) -> α203)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α202,) -> α203)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α202
//│ ╟── while constraining:  α190  <!<  α202
//│ ╟── while constraining:  (α190,)  <!<  (α202,)
//│ ╟── while constraining:  (α202 -> (α209 -> (val211 | α213)))  <!<  ((α190,) -> α191)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α190,) -> α191)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α190
//│ ╟── while constraining:  α178  <!<  α190
//│ ╟── while constraining:  (α178,)  <!<  (α190,)
//│ ╟── while constraining:  (α190 -> (α197 -> (val199 | α201)))  <!<  ((α178,) -> α179)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α178,) -> α179)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α178
//│ ╟── while constraining:  α166  <!<  α178
//│ ╟── while constraining:  (α166,)  <!<  (α178,)
//│ ╟── while constraining:  (α178 -> (α185 -> (val187 | α189)))  <!<  ((α166,) -> α167)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α166,) -> α167)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α166
//│ ╟── while constraining:  α154  <!<  α166
//│ ╟── while constraining:  (α154,)  <!<  (α166,)
//│ ╟── while constraining:  (α166 -> (α173 -> (val175 | α177)))  <!<  ((α154,) -> α155)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α154,) -> α155)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α154
//│ ╟── while constraining:  α142  <!<  α154
//│ ╟── while constraining:  (α142,)  <!<  (α154,)
//│ ╟── while constraining:  (α154 -> (α161 -> (val163 | α165)))  <!<  ((α142,) -> α143)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α142,) -> α143)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α142
//│ ╟── while constraining:  α130  <!<  α142
//│ ╟── while constraining:  (α130,)  <!<  (α142,)
//│ ╟── while constraining:  (α142 -> (α149 -> (val151 | α153)))  <!<  ((α130,) -> α131)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α130,) -> α131)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α130
//│ ╟── while constraining:  α118  <!<  α130
//│ ╟── while constraining:  (α118,)  <!<  (α130,)
//│ ╟── while constraining:  (α130 -> (α137 -> (val139 | α141)))  <!<  ((α118,) -> α119)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α118,) -> α119)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α118
//│ ╟── while constraining:  α106  <!<  α118
//│ ╟── while constraining:  (α106,)  <!<  (α118,)
//│ ╟── while constraining:  (α118 -> (α125 -> (val127 | α129)))  <!<  ((α106,) -> α107)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α106,) -> α107)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α106
//│ ╟── while constraining:  α94  <!<  α106
//│ ╟── while constraining:  (α94,)  <!<  (α106,)
//│ ╟── while constraining:  (α106 -> (α113 -> (val115 | α117)))  <!<  ((α94,) -> α95)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α94,) -> α95)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α94
//│ ╟── while constraining:  α82  <!<  α94
//│ ╟── while constraining:  (α82,)  <!<  (α94,)
//│ ╟── while constraining:  (α94 -> (α101 -> (val103 | α105)))  <!<  ((α82,) -> α83)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α82,) -> α83)
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α82
//│ ╟── while constraining:  (‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,)  <!<  (α82,)
//│ ╟── while constraining:  (α82 -> (α89 -> (val91 | α93)))  <!<  ((‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,) -> α81)
//│ ╙── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,) -> α81)
//│ res: error
//│    = [Function (anonymous)]

class Neg: Expr & { underlying: Expr }
//│ Defined class Neg

def evalN evalN x = case x of {
  Neg -> 0 - (evalN evalN x.underlying)
  | _ -> eval evalN x
  }
//│ evalN: ('a -> 'underlying -> int & 'a -> 'rhs -> int & 'a -> 'lhs -> int & 'a) -> ((Add with {lhs: 'lhs, rhs: 'rhs}) | (Lit with {val: 'val}) | (Neg with {underlying: 'underlying})) -> (int | 'val)
//│      = [Function: evalN]

:e
evalN evalN
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?underlying, ?rhs, ?lhs, ?val, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i, ?j, ?k, ?l, ?m, ?n, ?o, ?p, ?q. ?a -> ?i -> (?o | ?p) <: (forall ?underlying, ?rhs, ?lhs, ?val, ?r, ?s, ?t, ?u, ?v, ?w, ?x, ?y, ?z, ?a1, ?b1, ?c1, ?d1, ?e1, ?f1, ?g1, ?h1. ?r -> ?z -> (?f1 | ?g1)) -> ?i1` exceeded recursion depth limit (400)
//│ ║  l.108: 	evalN evalN
//│ ║         	^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α482
//│ ╟── while constraining:  α462  <!<  α482
//│ ╟── while constraining:  (α462,)  <!<  (α482,)
//│ ╟── while constraining:  (α482 -> (α493 -> (α500 | α501)))  <!<  ((α462,) -> α463)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α462,) -> α463)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α462
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α461
//│ ╟── while constraining:  α441  <!<  α461
//│ ╟── while constraining:  (α441,)  <!<  (α461,)
//│ ╟── while constraining:  (α461 -> (α472 -> (α479 | α480)))  <!<  ((α441,) -> α442)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α441,) -> α442)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α441
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α440
//│ ╟── while constraining:  α420  <!<  α440
//│ ╟── while constraining:  (α420,)  <!<  (α440,)
//│ ╟── while constraining:  (α440 -> (α451 -> (α458 | α459)))  <!<  ((α420,) -> α421)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α420,) -> α421)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α420
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α419
//│ ╟── while constraining:  α399  <!<  α419
//│ ╟── while constraining:  (α399,)  <!<  (α419,)
//│ ╟── while constraining:  (α419 -> (α430 -> (α437 | α438)))  <!<  ((α399,) -> α400)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α399,) -> α400)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α399
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α398
//│ ╟── while constraining:  α378  <!<  α398
//│ ╟── while constraining:  (α378,)  <!<  (α398,)
//│ ╟── while constraining:  (α398 -> (α409 -> (α416 | α417)))  <!<  ((α378,) -> α379)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α378,) -> α379)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α378
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α377
//│ ╟── while constraining:  α357  <!<  α377
//│ ╟── while constraining:  (α357,)  <!<  (α377,)
//│ ╟── while constraining:  (α377 -> (α388 -> (α395 | α396)))  <!<  ((α357,) -> α358)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α357,) -> α358)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α357
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α356
//│ ╟── while constraining:  α336  <!<  α356
//│ ╟── while constraining:  (α336,)  <!<  (α356,)
//│ ╟── while constraining:  (α356 -> (α367 -> (α374 | α375)))  <!<  ((α336,) -> α337)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α336,) -> α337)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α336
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α335
//│ ╟── while constraining:  α315  <!<  α335
//│ ╟── while constraining:  (α315,)  <!<  (α335,)
//│ ╟── while constraining:  (α335 -> (α346 -> (α353 | α354)))  <!<  ((α315,) -> α316)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α315,) -> α316)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α315
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α314
//│ ╟── while constraining:  (‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,)  <!<  (α314,)
//│ ╟── while constraining:  (α314 -> (α325 -> (α332 | α333)))  <!<  ((‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,) -> α313)
//│ ╙── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,) -> α313)
//│ res: error
//│    = [Function (anonymous)]

e = Add{lhs = Lit{val = 1}; rhs = Neg{underlying = Lit{val = 2}}}
//│ e: Add with {lhs: Lit & {val: 1}, rhs: Neg with {underlying: Lit & {val: 2}}}
//│  = Add { lhs: Lit { val: 1 }, rhs: Neg { underlying: Lit { val: 2 } } }

:e
evalN evalN e
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?underlying, ?rhs, ?lhs, ?val, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i, ?j, ?k, ?l, ?m, ?n, ?o, ?p, ?q. ?a -> ?i -> (?o | ?p) <: (forall ?underlying, ?rhs, ?lhs, ?val, ?r, ?s, ?t, ?u, ?v, ?w, ?x, ?y, ?z, ?a1, ?b1, ?c1, ?d1, ?e1, ?f1, ?g1, ?h1. ?r -> ?z -> (?f1 | ?g1)) -> ?i1` exceeded recursion depth limit (400)
//│ ║  l.172: 	evalN evalN e
//│ ║         	^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α722
//│ ╟── while constraining:  α702  <!<  α722
//│ ╟── while constraining:  (α702,)  <!<  (α722,)
//│ ╟── while constraining:  (α722 -> (α733 -> (α740 | α741)))  <!<  ((α702,) -> α703)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α702,) -> α703)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α702
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α701
//│ ╟── while constraining:  α681  <!<  α701
//│ ╟── while constraining:  (α681,)  <!<  (α701,)
//│ ╟── while constraining:  (α701 -> (α712 -> (α719 | α720)))  <!<  ((α681,) -> α682)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α681,) -> α682)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α681
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α680
//│ ╟── while constraining:  α660  <!<  α680
//│ ╟── while constraining:  (α660,)  <!<  (α680,)
//│ ╟── while constraining:  (α680 -> (α691 -> (α698 | α699)))  <!<  ((α660,) -> α661)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α660,) -> α661)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α660
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α659
//│ ╟── while constraining:  α639  <!<  α659
//│ ╟── while constraining:  (α639,)  <!<  (α659,)
//│ ╟── while constraining:  (α659 -> (α670 -> (α677 | α678)))  <!<  ((α639,) -> α640)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α639,) -> α640)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α639
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α638
//│ ╟── while constraining:  α618  <!<  α638
//│ ╟── while constraining:  (α618,)  <!<  (α638,)
//│ ╟── while constraining:  (α638 -> (α649 -> (α656 | α657)))  <!<  ((α618,) -> α619)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α618,) -> α619)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α618
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α617
//│ ╟── while constraining:  α597  <!<  α617
//│ ╟── while constraining:  (α597,)  <!<  (α617,)
//│ ╟── while constraining:  (α617 -> (α628 -> (α635 | α636)))  <!<  ((α597,) -> α598)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α597,) -> α598)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α597
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α596
//│ ╟── while constraining:  α576  <!<  α596
//│ ╟── while constraining:  (α576,)  <!<  (α596,)
//│ ╟── while constraining:  (α596 -> (α607 -> (α614 | α615)))  <!<  ((α576,) -> α577)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α576,) -> α577)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α576
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α575
//│ ╟── while constraining:  α555  <!<  α575
//│ ╟── while constraining:  (α555,)  <!<  (α575,)
//│ ╟── while constraining:  (α575 -> (α586 -> (α593 | α594)))  <!<  ((α555,) -> α556)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((α555,) -> α556)
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α555
//│ ╟── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  α554
//│ ╟── while constraining:  (‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,)  <!<  (α554,)
//│ ╟── while constraining:  (α554 -> (α565 -> (α572 | α573)))  <!<  ((‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,) -> α553)
//│ ╙── while constraining:  ‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›  <!<  ((‹∀ 0. (α259' -> (α260' -> (α266' | α281')))›,) -> α553)
//│ res: error
//│    = -1




// === === === ERROR CASES === === === //



:ShowRelativeLineNums
:AllowTypeErrors



:e
def evalN2 evalN2 x = case x of {
  Neg -> 0 - (evalN2 evalN2 x.underlying)
  | _ -> eval eval x
  }
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?val, ?lhs, ?rhs, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i. ?a -> ?f -> (?val | ?i) <: (forall ?val, ?lhs, ?rhs, ?j, ?k, ?l, ?m, ?n, ?o, ?p, ?q, ?r. ?j -> ?o -> (?val | ?r)) -> ?s` exceeded recursion depth limit (400)
//│ ║  l.+3: 	  | _ -> eval eval x
//│ ║        	         ^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α933'
//│ ╟── while constraining:  α921'  <!<  α933'
//│ ╟── while constraining:  (α921',)  <!<  (α933',)
//│ ╟── while constraining:  (α933' -> (α940' -> (val942' | α944')))  <!<  ((α921',) -> α922')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α921',) -> α922')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α921'
//│ ╟── while constraining:  α909'  <!<  α921'
//│ ╟── while constraining:  (α909',)  <!<  (α921',)
//│ ╟── while constraining:  (α921' -> (α928' -> (val930' | α932')))  <!<  ((α909',) -> α910')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α909',) -> α910')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α909'
//│ ╟── while constraining:  α897'  <!<  α909'
//│ ╟── while constraining:  (α897',)  <!<  (α909',)
//│ ╟── while constraining:  (α909' -> (α916' -> (val918' | α920')))  <!<  ((α897',) -> α898')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α897',) -> α898')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α897'
//│ ╟── while constraining:  α885'  <!<  α897'
//│ ╟── while constraining:  (α885',)  <!<  (α897',)
//│ ╟── while constraining:  (α897' -> (α904' -> (val906' | α908')))  <!<  ((α885',) -> α886')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α885',) -> α886')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α885'
//│ ╟── while constraining:  α873'  <!<  α885'
//│ ╟── while constraining:  (α873',)  <!<  (α885',)
//│ ╟── while constraining:  (α885' -> (α892' -> (val894' | α896')))  <!<  ((α873',) -> α874')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α873',) -> α874')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α873'
//│ ╟── while constraining:  α861'  <!<  α873'
//│ ╟── while constraining:  (α861',)  <!<  (α873',)
//│ ╟── while constraining:  (α873' -> (α880' -> (val882' | α884')))  <!<  ((α861',) -> α862')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α861',) -> α862')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α861'
//│ ╟── while constraining:  α849'  <!<  α861'
//│ ╟── while constraining:  (α849',)  <!<  (α861',)
//│ ╟── while constraining:  (α861' -> (α868' -> (val870' | α872')))  <!<  ((α849',) -> α850')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α849',) -> α850')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α849'
//│ ╟── while constraining:  α837'  <!<  α849'
//│ ╟── while constraining:  (α837',)  <!<  (α849',)
//│ ╟── while constraining:  (α849' -> (α856' -> (val858' | α860')))  <!<  ((α837',) -> α838')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α837',) -> α838')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α837'
//│ ╟── while constraining:  α825'  <!<  α837'
//│ ╟── while constraining:  (α825',)  <!<  (α837',)
//│ ╟── while constraining:  (α837' -> (α844' -> (val846' | α848')))  <!<  ((α825',) -> α826')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α825',) -> α826')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α825'
//│ ╟── while constraining:  α813'  <!<  α825'
//│ ╟── while constraining:  (α813',)  <!<  (α825',)
//│ ╟── while constraining:  (α825' -> (α832' -> (val834' | α836')))  <!<  ((α813',) -> α814')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α813',) -> α814')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α813'
//│ ╟── while constraining:  α801'  <!<  α813'
//│ ╟── while constraining:  (α801',)  <!<  (α813',)
//│ ╟── while constraining:  (α813' -> (α820' -> (val822' | α824')))  <!<  ((α801',) -> α802')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α801',) -> α802')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α801'
//│ ╟── while constraining:  α789'  <!<  α801'
//│ ╟── while constraining:  (α789',)  <!<  (α801',)
//│ ╟── while constraining:  (α801' -> (α808' -> (val810' | α812')))  <!<  ((α789',) -> α790')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((α789',) -> α790')
//│ ╟── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  α789'
//│ ╟── while constraining:  (‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,)  <!<  (α789',)
//│ ╟── while constraining:  (α789' -> (α796' -> (val798' | α800')))  <!<  ((‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,) -> α788')
//│ ╙── while constraining:  ‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›  <!<  ((‹∀ 0. (α48' -> (α49' -> (val51' | α60')))›,) -> α788')
//│ evalN2: ('a -> 'underlying -> int & 'a) -> ((Neg with {underlying: 'underlying}) | ~Neg) -> (error | int)

:e
evalN2 evalN2 e
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?underlying, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h. ?b -> ?e -> (?g | ?h) <: (forall ?underlying, ?a, ?i, ?j, ?k, ?l, ?m, ?n, ?o. ?i -> ?l -> (?n | ?o)) -> ?p` exceeded recursion depth limit (400)
//│ ║  l.+1: 	evalN2 evalN2 e
//│ ║        	^^^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1086
//│ ╟── while constraining:  α1077  <!<  α1086
//│ ╟── while constraining:  (α1077,)  <!<  (α1086,)
//│ ╟── while constraining:  (α1086 -> (α1090 -> (α1093 | α1094)))  <!<  ((α1077,) -> α1078)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1077,) -> α1078)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1077
//│ ╟── while constraining:  α1068  <!<  α1077
//│ ╟── while constraining:  (α1068,)  <!<  (α1077,)
//│ ╟── while constraining:  (α1077 -> (α1081 -> (α1084 | α1085)))  <!<  ((α1068,) -> α1069)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1068,) -> α1069)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1068
//│ ╟── while constraining:  α1059  <!<  α1068
//│ ╟── while constraining:  (α1059,)  <!<  (α1068,)
//│ ╟── while constraining:  (α1068 -> (α1072 -> (α1075 | α1076)))  <!<  ((α1059,) -> α1060)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1059,) -> α1060)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1059
//│ ╟── while constraining:  α1050  <!<  α1059
//│ ╟── while constraining:  (α1050,)  <!<  (α1059,)
//│ ╟── while constraining:  (α1059 -> (α1063 -> (α1066 | α1067)))  <!<  ((α1050,) -> α1051)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1050,) -> α1051)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1050
//│ ╟── while constraining:  α1041  <!<  α1050
//│ ╟── while constraining:  (α1041,)  <!<  (α1050,)
//│ ╟── while constraining:  (α1050 -> (α1054 -> (α1057 | α1058)))  <!<  ((α1041,) -> α1042)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1041,) -> α1042)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1041
//│ ╟── while constraining:  α1032  <!<  α1041
//│ ╟── while constraining:  (α1032,)  <!<  (α1041,)
//│ ╟── while constraining:  (α1041 -> (α1045 -> (α1048 | α1049)))  <!<  ((α1032,) -> α1033)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1032,) -> α1033)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1032
//│ ╟── while constraining:  α1023  <!<  α1032
//│ ╟── while constraining:  (α1023,)  <!<  (α1032,)
//│ ╟── while constraining:  (α1032 -> (α1036 -> (α1039 | α1040)))  <!<  ((α1023,) -> α1024)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1023,) -> α1024)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1023
//│ ╟── while constraining:  α1014  <!<  α1023
//│ ╟── while constraining:  (α1014,)  <!<  (α1023,)
//│ ╟── while constraining:  (α1023 -> (α1027 -> (α1030 | α1031)))  <!<  ((α1014,) -> α1015)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1014,) -> α1015)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1014
//│ ╟── while constraining:  α1005  <!<  α1014
//│ ╟── while constraining:  (α1005,)  <!<  (α1014,)
//│ ╟── while constraining:  (α1014 -> (α1018 -> (α1021 | α1022)))  <!<  ((α1005,) -> α1006)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α1005,) -> α1006)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α1005
//│ ╟── while constraining:  α996  <!<  α1005
//│ ╟── while constraining:  (α996,)  <!<  (α1005,)
//│ ╟── while constraining:  (α1005 -> (α1009 -> (α1012 | α1013)))  <!<  ((α996,) -> α997)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α996,) -> α997)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α996
//│ ╟── while constraining:  α987  <!<  α996
//│ ╟── while constraining:  (α987,)  <!<  (α996,)
//│ ╟── while constraining:  (α996 -> (α1000 -> (α1003 | α1004)))  <!<  ((α987,) -> α988)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α987,) -> α988)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α987
//│ ╟── while constraining:  α978  <!<  α987
//│ ╟── while constraining:  (α978,)  <!<  (α987,)
//│ ╟── while constraining:  (α987 -> (α991 -> (α994 | α995)))  <!<  ((α978,) -> α979)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((α978,) -> α979)
//│ ╟── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  α978
//│ ╟── while constraining:  (‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›,)  <!<  (α978,)
//│ ╟── while constraining:  (α978 -> (α982 -> (α985 | α986)))  <!<  ((‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›,) -> α977)
//│ ╙── while constraining:  ‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›  <!<  ((‹∀ 0. (α779' -> (α780' -> (α786' | α963')))›,) -> α977)
//│ res: error


def evalN3 evalN3 x = case x of {
  Neg -> 0 - (evalN2 x.underlying)
  | _ -> eval evalN3 x
  }
//│ ╔══[ERROR] Type mismatch in operator application:
//│ ║  l.+2: 	  Neg -> 0 - (evalN2 x.underlying)
//│ ║        	         ^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ╟── function of type `?a -> (?b | ?c)` is not an instance of type `int`
//│ ║  l.244: 	def evalN2 evalN2 x = case x of {
//│ ║         	                  ^^^^^^^^^^^^^^^
//│ ║  l.245: 	  Neg -> 0 - (evalN2 evalN2 x.underlying)
//│ ║         	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.246: 	  | _ -> eval eval x
//│ ║         	^^^^^^^^^^^^^^^^^^^^
//│ ║  l.247: 	  }
//│ ║         	^^^
//│ ╟── but it flows into application with expected type `int`
//│ ║  l.+2: 	  Neg -> 0 - (evalN2 x.underlying)
//│ ╙──      	              ^^^^^^^^^^^^^^^^^^^
//│ evalN3: ('a -> 'rhs -> int & 'a -> 'lhs -> int & 'a) -> ((Add with {lhs: 'lhs, rhs: 'rhs}) | (Lit with {val: 'val}) | (Neg with {underlying: 'b -> nothing -> int & 'b})) -> (error | int | 'val)

def evalN3 evalN3 x = case x of {
  Neg -> 0 - (evalN3 x.underlying)
  | _ -> eval evalN3 x
  }
//│ evalN3: ('underlying -> int & 'a -> 'rhs -> int & 'a -> 'lhs -> int & 'a) -> ((Add with {lhs: 'lhs, rhs: 'rhs}) | (Lit with {val: 'val}) | (Neg with {underlying: 'underlying})) -> (int | 'val)

:e
evalN3 evalN3 e
//│ ╔══[ERROR] Subtyping constraint of the form `forall ?underlying, ?rhs, ?lhs, ?val, ?a, ?b, ?c, ?d, ?e, ?f, ?g, ?h, ?i, ?j, ?k, ?l, ?m, ?n, ?o, ?p. ?a -> ?h -> (?n | ?o) <: (forall ?underlying, ?rhs, ?lhs, ?val, ?q, ?r, ?s, ?t, ?u, ?v, ?w, ?x, ?y, ?z, ?a1, ?b1, ?c1, ?d1, ?e1, ?f1. ?q -> ?x -> (?d1 | ?e1)) -> ?g1` exceeded recursion depth limit (400)
//│ ║  l.+1: 	evalN3 evalN3 e
//│ ║        	^^^^^^^^^^^^^
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1392
//│ ╟── while constraining:  α1373  <!<  α1392
//│ ╟── while constraining:  (α1373,)  <!<  (α1392,)
//│ ╟── while constraining:  (α1392 -> (α1402 -> (α1409 | α1410)))  <!<  ((α1373,) -> α1374)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1373,) -> α1374)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1373
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1372
//│ ╟── while constraining:  α1353  <!<  α1372
//│ ╟── while constraining:  (α1353,)  <!<  (α1372,)
//│ ╟── while constraining:  (α1372 -> (α1382 -> (α1389 | α1390)))  <!<  ((α1353,) -> α1354)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1353,) -> α1354)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1353
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1352
//│ ╟── while constraining:  α1333  <!<  α1352
//│ ╟── while constraining:  (α1333,)  <!<  (α1352,)
//│ ╟── while constraining:  (α1352 -> (α1362 -> (α1369 | α1370)))  <!<  ((α1333,) -> α1334)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1333,) -> α1334)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1333
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1332
//│ ╟── while constraining:  α1313  <!<  α1332
//│ ╟── while constraining:  (α1313,)  <!<  (α1332,)
//│ ╟── while constraining:  (α1332 -> (α1342 -> (α1349 | α1350)))  <!<  ((α1313,) -> α1314)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1313,) -> α1314)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1313
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1312
//│ ╟── while constraining:  α1293  <!<  α1312
//│ ╟── while constraining:  (α1293,)  <!<  (α1312,)
//│ ╟── while constraining:  (α1312 -> (α1322 -> (α1329 | α1330)))  <!<  ((α1293,) -> α1294)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1293,) -> α1294)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1293
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1292
//│ ╟── while constraining:  α1273  <!<  α1292
//│ ╟── while constraining:  (α1273,)  <!<  (α1292,)
//│ ╟── while constraining:  (α1292 -> (α1302 -> (α1309 | α1310)))  <!<  ((α1273,) -> α1274)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1273,) -> α1274)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1273
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1272
//│ ╟── while constraining:  α1253  <!<  α1272
//│ ╟── while constraining:  (α1253,)  <!<  (α1272,)
//│ ╟── while constraining:  (α1272 -> (α1282 -> (α1289 | α1290)))  <!<  ((α1253,) -> α1254)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1253,) -> α1254)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1253
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1252
//│ ╟── while constraining:  α1233  <!<  α1252
//│ ╟── while constraining:  (α1233,)  <!<  (α1252,)
//│ ╟── while constraining:  (α1252 -> (α1262 -> (α1269 | α1270)))  <!<  ((α1233,) -> α1234)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((α1233,) -> α1234)
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1233
//│ ╟── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  α1232
//│ ╟── while constraining:  (‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›,)  <!<  (α1232,)
//│ ╟── while constraining:  (α1232 -> (α1242 -> (α1249 | α1250)))  <!<  ((‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›,) -> α1231)
//│ ╙── while constraining:  ‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›  <!<  ((‹∀ 0. (α1179' -> (α1180' -> (α1185' | α1200')))›,) -> α1231)
//│ res: error


