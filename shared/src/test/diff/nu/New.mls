:NewParser


class Foo(x)
//│ Defined class Foo
//│ Foo: 'x -> (Foo with {x: 'x})
//│    = [Function: Foo1]

let f = Foo(1)
//│ f: Foo & {x: 1}
//│  = Foo { x: 1 }

:ge
let f = new Foo(1)
//│ f: Foo & {x: 1}
//│ Code generation encountered an error:
//│   cannot generate code for term New(Some((TypeName(Foo),1,)), TypingUnit(List()))

if f is Foo(a) then a else 0
//│ res: 1
//│    = 1

// case f of
//   { Foo ->
//     let a = f.x
//     a
//   | _ -> 0
//   }

// Foo(A) =:= Foo & { x: A }


fun test(x) = if x is Foo(a) then a
//│ test: (Foo with {x: 'x}) -> 'x
//│     = [Function: test]

test(f)
//│ res: 1
//│    = 1

