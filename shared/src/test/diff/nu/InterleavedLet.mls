:NewParser

if a is
  Some(v) and v is
    Left(x) then x
    let y = v + 1
    Right(0) then y
    Right(x) then x + y
  else 0
//│ /!!!\ Uncaught error: java.lang.Exception: Some not found
//│ 	at: mlscript.Typer.destructPattern(Typer.scala:990)
//│ 	at: mlscript.Typer.desugarMatchBranch$1(Typer.scala:1084)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2(Typer.scala:1152)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2$adapted(Typer.scala:1152)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1152)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:744)

if a is
  Left(x) then x
  let y = a + 1
  then y
//│ ╔══[PARSE ERROR] Expected an expression; found a 'then'/'else' clause instead
//│ ║  l.24: 	  let y = a + 1
//│ ║        	          ^^^^^
//│ ║  l.25: 	  then y
//│ ╙──      	^^^^^^^^
//│ /!!!\ Uncaught error: java.lang.Exception: Left not found
//│ 	at: mlscript.Typer.destructPattern(Typer.scala:990)
//│ 	at: mlscript.Typer.desugarMatchBranch$1(Typer.scala:1073)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2(Typer.scala:1152)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2$adapted(Typer.scala:1152)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1152)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:744)

if
  A then "A"
  let y = 0
  B then "B"
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$3(Typer.scala:1165)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$3$adapted(Typer.scala:1163)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1163)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:744)
//│ 	at: mlscript.Typer.typeStatement(Typer.scala:376)

if x is
  A() then "A"
  let y = 0
  B() then "B"
//│ /!!!\ Uncaught error: java.lang.Exception: A not found
//│ 	at: mlscript.Typer.destructPattern(Typer.scala:990)
//│ 	at: mlscript.Typer.desugarMatchBranch$1(Typer.scala:1073)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2(Typer.scala:1152)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2$adapted(Typer.scala:1152)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1152)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:744)

if x
  is A() then "A"
  let y = 0
  is B() then "B"
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.NewParser.$anonfun$opIfBlock$1(NewParser.scala:735)
//│ 	at: mlscript.NewParser.wrap(NewParser.scala:52)
//│ 	at: mlscript.NewParser.opIfBlock(NewParser.scala:719)
//│ 	at: mlscript.NewParser.$anonfun$opBlock$1(NewParser.scala:716)
//│ 	at: mlscript.NewParser.wrap(NewParser.scala:52)
//│ 	at: mlscript.NewParser.opBlock(NewParser.scala:691)
//│ 	at: mlscript.NewParser.$anonfun$exprCont$3(NewParser.scala:580)
//│ 	at: mlscript.NewParser.concludeWith(NewParser.scala:70)
//│ 	at: mlscript.NewParser.$anonfun$exprCont$1(NewParser.scala:580)

if x ==
  let y = f(z)
  y * y then 0
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$3(Typer.scala:1165)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$3$adapted(Typer.scala:1163)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1163)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:744)
//│ 	at: mlscript.Typer.typeStatement(Typer.scala:376)

if
  x == 0 then 0
  let y = 0
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$3(Typer.scala:1165)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$3$adapted(Typer.scala:1163)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1163)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:744)
//│ 	at: mlscript.Typer.typeStatement(Typer.scala:376)

if
  x == 0 then 0
  let y = f(x)
  let z = f(x, y)
  z == 1 then 1
  z == 2 then 2
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$3(Typer.scala:1165)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$3$adapted(Typer.scala:1163)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1163)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:744)
//│ 	at: mlscript.Typer.typeStatement(Typer.scala:376)

:pe
if x
  == 0 then "bad"
  let y = f(z)
  == y * y then 0
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.NewParser.$anonfun$opIfBlock$1(NewParser.scala:735)
//│ 	at: mlscript.NewParser.wrap(NewParser.scala:52)
//│ 	at: mlscript.NewParser.opIfBlock(NewParser.scala:719)
//│ 	at: mlscript.NewParser.$anonfun$opBlock$1(NewParser.scala:716)
//│ 	at: mlscript.NewParser.wrap(NewParser.scala:52)
//│ 	at: mlscript.NewParser.opBlock(NewParser.scala:691)
//│ 	at: mlscript.NewParser.$anonfun$exprCont$3(NewParser.scala:580)
//│ 	at: mlscript.NewParser.concludeWith(NewParser.scala:70)
//│ 	at: mlscript.NewParser.$anonfun$exprCont$1(NewParser.scala:580)

if q(y) and
  let z = f(y)
  y == z * z then "bruh"
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$3(Typer.scala:1165)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$3$adapted(Typer.scala:1163)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1163)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:744)
//│ 	at: mlscript.Typer.typeStatement(Typer.scala:376)

if x is
  Some(v) then v
  let tmp = 1
  None then tmp
//│ /!!!\ Uncaught error: java.lang.Exception: Some not found
//│ 	at: mlscript.Typer.destructPattern(Typer.scala:990)
//│ 	at: mlscript.Typer.desugarMatchBranch$1(Typer.scala:1073)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2(Typer.scala:1152)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2$adapted(Typer.scala:1152)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1152)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:744)

if xs is
  Nil then Nil
  Cons(x, xs) and f(x) is
    let Pair(l, r) = mapPartition(f, xs)
    Left(v)  then (v :: l, r)
    Right(v) then (l, v :: r)
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.Typer.destructPattern(Typer.scala:983)
//│ 	at: mlscript.Typer.desugarMatchBranch$1(Typer.scala:1073)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2(Typer.scala:1152)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2$adapted(Typer.scala:1152)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1152)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)

if a is
  Some(x) and x is
    Left(a)  then "left-defined"
    let y = x + 1
    Right(b) then "right-defined"
  None       then "undefined"
//│ /!!!\ Uncaught error: java.lang.Exception: Some not found
//│ 	at: mlscript.Typer.destructPattern(Typer.scala:990)
//│ 	at: mlscript.Typer.desugarMatchBranch$1(Typer.scala:1084)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2(Typer.scala:1152)
//│ 	at: mlscript.Typer.$anonfun$desugarIf$2$adapted(Typer.scala:1152)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.Typer.desugarIfBody$1(Typer.scala:1152)
//│ 	at: mlscript.Typer.desugarIf(Typer.scala:1170)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:744)
