:NewParser

if a is
  Some(v) and v is
    Left(x) then x
    let y = v + 1
    Right(0) then y
    Right(x) then x + y
  else 0
//│ ╔══[ERROR] class Some not found
//│ ║  l.3: 	if a is
//│ ║       	   ^^^^
//│ ║  l.4: 	  Some(v) and v is
//│ ║       	^^^^^^^^^^^^^^^^^^
//│ ║  l.5: 	    Left(x) then x
//│ ║       	^^^^^^^^^^^^^^^^^^
//│ ║  l.6: 	    let y = v + 1
//│ ║       	^^^^^^^^^^^^^^^^^
//│ ║  l.7: 	    Right(0) then y
//│ ║       	^^^^^^^^^^^^^^^^^^^
//│ ║  l.8: 	    Right(x) then x + y
//│ ║       	^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.9: 	  else 0
//│ ╙──     	^^^^^^^^
//│ res: error
//│ Code generation encountered an error:
//│   if expression has not been desugared

if a is
  Left(x) then x
  let y = a + 1
  then y
//│ ╔══[PARSE ERROR] Expected an expression; found a 'then'/'else' clause instead
//│ ║  l.31: 	  let y = a + 1
//│ ║        	          ^^^^^
//│ ║  l.32: 	  then y
//│ ╙──      	^^^^^^^^
//│ ╔══[ERROR] class Left not found
//│ ║  l.29: 	if a is
//│ ║        	   ^^^^
//│ ║  l.30: 	  Left(x) then x
//│ ║        	^^^^^^^^^^^^^^^^
//│ ║  l.31: 	  let y = a + 1
//│ ║        	^^^^^^^^^^^^^^^
//│ ║  l.32: 	  then y
//│ ╙──      	^^^^^^^^
//│ res: error
//│ Code generation encountered an error:
//│   if expression has not been desugared

if
  A then "A"
  let y = 0
  B then "B"
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.UltimateConditions.$anonfun$desugarIf$10(UltimateConditions.scala:310)
//│ 	at: mlscript.UltimateConditions.$anonfun$desugarIf$10$adapted(UltimateConditions.scala:308)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.UltimateConditions.desugarIfBody$1(UltimateConditions.scala:308)
//│ 	at: mlscript.UltimateConditions.desugarIf(UltimateConditions.scala:316)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:750)
//│ 	at: mlscript.Typer.typeStatement(Typer.scala:376)

if x is
  A() then "A"
  let y = 0
  B() then "B"
//│ ╔══[ERROR] class A not found
//│ ║  l.67: 	if x is
//│ ║        	   ^^^^
//│ ║  l.68: 	  A() then "A"
//│ ║        	^^^^^^^^^^^^^^
//│ ║  l.69: 	  let y = 0
//│ ║        	^^^^^^^^^^^
//│ ║  l.70: 	  B() then "B"
//│ ╙──      	^^^^^^^^^^^^^^
//│ res: error
//│ Code generation encountered an error:
//│   if expression has not been desugared

if x
  is A() then "A"
  let y = 0
  is B() then "B"
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.NewParser.$anonfun$opIfBlock$1(NewParser.scala:735)
//│ 	at: mlscript.NewParser.wrap(NewParser.scala:52)
//│ 	at: mlscript.NewParser.opIfBlock(NewParser.scala:719)
//│ 	at: mlscript.NewParser.$anonfun$opBlock$1(NewParser.scala:716)
//│ 	at: mlscript.NewParser.wrap(NewParser.scala:52)
//│ 	at: mlscript.NewParser.opBlock(NewParser.scala:691)
//│ 	at: mlscript.NewParser.$anonfun$exprCont$3(NewParser.scala:580)
//│ 	at: mlscript.NewParser.concludeWith(NewParser.scala:70)
//│ 	at: mlscript.NewParser.$anonfun$exprCont$1(NewParser.scala:580)

if x ==
  let y = f(z)
  y * y then 0
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.UltimateConditions.$anonfun$desugarIf$10(UltimateConditions.scala:310)
//│ 	at: mlscript.UltimateConditions.$anonfun$desugarIf$10$adapted(UltimateConditions.scala:308)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.UltimateConditions.desugarIfBody$1(UltimateConditions.scala:308)
//│ 	at: mlscript.UltimateConditions.desugarIf(UltimateConditions.scala:316)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:750)
//│ 	at: mlscript.Typer.typeStatement(Typer.scala:376)

if
  x == 0 then 0
  let y = 0
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.UltimateConditions.$anonfun$desugarIf$10(UltimateConditions.scala:310)
//│ 	at: mlscript.UltimateConditions.$anonfun$desugarIf$10$adapted(UltimateConditions.scala:308)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.UltimateConditions.desugarIfBody$1(UltimateConditions.scala:308)
//│ 	at: mlscript.UltimateConditions.desugarIf(UltimateConditions.scala:316)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:750)
//│ 	at: mlscript.Typer.typeStatement(Typer.scala:376)

if
  x == 0 then 0
  let y = f(x)
  let z = f(x, y)
  z == 1 then 1
  z == 2 then 2
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.UltimateConditions.$anonfun$desugarIf$10(UltimateConditions.scala:310)
//│ 	at: mlscript.UltimateConditions.$anonfun$desugarIf$10$adapted(UltimateConditions.scala:308)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.UltimateConditions.desugarIfBody$1(UltimateConditions.scala:308)
//│ 	at: mlscript.UltimateConditions.desugarIf(UltimateConditions.scala:316)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:750)
//│ 	at: mlscript.Typer.typeStatement(Typer.scala:376)

:pe
if x
  == 0 then "bad"
  let y = f(z)
  == y * y then 0
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.NewParser.$anonfun$opIfBlock$1(NewParser.scala:735)
//│ 	at: mlscript.NewParser.wrap(NewParser.scala:52)
//│ 	at: mlscript.NewParser.opIfBlock(NewParser.scala:719)
//│ 	at: mlscript.NewParser.$anonfun$opBlock$1(NewParser.scala:716)
//│ 	at: mlscript.NewParser.wrap(NewParser.scala:52)
//│ 	at: mlscript.NewParser.opBlock(NewParser.scala:691)
//│ 	at: mlscript.NewParser.$anonfun$exprCont$3(NewParser.scala:580)
//│ 	at: mlscript.NewParser.concludeWith(NewParser.scala:70)
//│ 	at: mlscript.NewParser.$anonfun$exprCont$1(NewParser.scala:580)

if q(y) and
  let z = f(y)
  y == z * z then "bruh"
//│ /!!!\ Uncaught error: scala.NotImplementedError: an implementation is missing
//│ 	at: scala.Predef$.$qmark$qmark$qmark(Predef.scala:344)
//│ 	at: mlscript.UltimateConditions.$anonfun$desugarIf$10(UltimateConditions.scala:310)
//│ 	at: mlscript.UltimateConditions.$anonfun$desugarIf$10$adapted(UltimateConditions.scala:308)
//│ 	at: scala.collection.immutable.List.foreach(List.scala:333)
//│ 	at: mlscript.UltimateConditions.desugarIfBody$1(UltimateConditions.scala:308)
//│ 	at: mlscript.UltimateConditions.desugarIf(UltimateConditions.scala:316)
//│ 	at: mlscript.Typer.$anonfun$typeTerm$2(Typer.scala:725)
//│ 	at: mlscript.TyperHelpers.trace(TyperHelpers.scala:30)
//│ 	at: mlscript.Typer.typeTerm(Typer.scala:750)
//│ 	at: mlscript.Typer.typeStatement(Typer.scala:376)

if x is
  Some(v) then v
  let tmp = 1
  None then tmp
//│ ╔══[ERROR] class Some not found
//│ ║  l.180: 	if x is
//│ ║         	   ^^^^
//│ ║  l.181: 	  Some(v) then v
//│ ║         	^^^^^^^^^^^^^^^^
//│ ║  l.182: 	  let tmp = 1
//│ ║         	^^^^^^^^^^^^^
//│ ║  l.183: 	  None then tmp
//│ ╙──       	^^^^^^^^^^^^^^^
//│ res: error
//│ Code generation encountered an error:
//│   if expression has not been desugared

if xs is
  Nil then Nil
  Cons(x, xs) and f(x) is
    let Pair(l, r) = mapPartition(f, xs)
    Left(v)  then (v :: l, r)
    Right(v) then (l, v :: r)
//│ ╔══[ERROR] constructor Nil not found
//│ ║  l.197: 	if xs is
//│ ║         	   ^^^^^
//│ ║  l.198: 	  Nil then Nil
//│ ║         	^^^^^^^^^^^^^^
//│ ║  l.199: 	  Cons(x, xs) and f(x) is
//│ ║         	^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.200: 	    let Pair(l, r) = mapPartition(f, xs)
//│ ║         	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.201: 	    Left(v)  then (v :: l, r)
//│ ║         	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.202: 	    Right(v) then (l, v :: r)
//│ ╙──       	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ res: error
//│ Code generation encountered an error:
//│   if expression has not been desugared

if a is
  Some(x) and x is
    Left(a)  then "left-defined"
    let y = x + 1
    Right(b) then "right-defined"
  None       then "undefined"
//│ ╔══[ERROR] class Some not found
//│ ║  l.220: 	if a is
//│ ║         	   ^^^^
//│ ║  l.221: 	  Some(x) and x is
//│ ║         	^^^^^^^^^^^^^^^^^^
//│ ║  l.222: 	    Left(a)  then "left-defined"
//│ ║         	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.223: 	    let y = x + 1
//│ ║         	^^^^^^^^^^^^^^^^^
//│ ║  l.224: 	    Right(b) then "right-defined"
//│ ║         	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.225: 	  None       then "undefined"
//│ ╙──       	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ res: error
//│ Code generation encountered an error:
//│   if expression has not been desugared
