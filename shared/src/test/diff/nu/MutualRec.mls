:NewParser
:NewDefs
:NoJS



class Foo()
123
//│ class Foo
//│ Typed: 123

Foo
//│ Typed: () -> Foo

fun fooo(x) =
  class C(y, z)
  C(0, x)
//│ fun fooo: ‹∀ 0. fooo26'#› where 
//│ |		fooo26'# := (α27' -> α35')
//│ |		α27' <: z30_37'
//│ |		α35' :> C<>
//│ [pretty-printed] fooo: anything -> C



fun foo = bar
fun bar = foo
//│ fun foo: ‹∀ 0. foo44'#› where 
//│ |		foo44'# := ‹∀ 0. bar45'#›
//│ |		bar45'# := foo44'#
//│ [pretty-printed] foo: nothing
//│ fun bar: ‹∀ 0. bar45'#› where 
//│ |		foo44'# := ‹∀ 0. bar45'#›
//│ |		bar45'# := foo44'#
//│ [pretty-printed] bar: nothing

foo(bar)
//│ Typed: nothing


fun foo = {x: foo}
//│ fun foo: ‹∀ 0. foo57'#› where 
//│ |		foo57'# := {x: foo57'#}
//│ [pretty-printed] foo: 'foo
//│ |  where
//│ |    'foo :> {x: 'foo}


fun foo = {x: bar}
fun bar = {y: foo}
//│ fun foo: ‹∀ 0. foo63'#› where 
//│ |		foo63'# := {x: ‹∀ 0. bar64'#›}
//│ |		bar64'# := {y: foo63'#}
//│ [pretty-printed] foo: 'foo
//│ |  where
//│ |    'foo :> {x: forall 'foo. {y: 'foo}}
//│ fun bar: ‹∀ 0. bar64'#› where 
//│ |		foo63'# := {x: ‹∀ 0. bar64'#›}
//│ |		bar64'# := {y: foo63'#}
//│ [pretty-printed] bar: 'bar
//│ |  where
//│ |    'bar :> {y: {x: forall 'bar. 'bar}}

// FIXME pretty-printing?
foo
//│ Typed: 'foo
//│   where
//│     'foo :> {x: forall 'foo. {y: 'foo}}

:ns
foo
//│ Typed: forall 'foo. 'foo
//│   where
//│     'foo := {x: forall 'bar 'foo. 'bar}
//│     'bar := {y: 'foo}

foo.x
//│ Typed: 'x
//│   where
//│     'x :> {y: {x: 'x}}

foo.x.y
//│ Typed: 'foo
//│   where
//│     'foo :> {x: forall 'foo. {y: 'foo}}


// FIXME:

fun foo(a) = {h: a, t: bar(a)}
fun bar(b) = foo(b)
//│ fun foo: ‹∀ 0. foo94'#› where 
//│ |		foo94'# := (α95' -> {h: α95', t: α99'})
//│ |		α95' <: α97_101'
//│ |		α99' :> ‹∀ 1. α98_100''›
//│ [pretty-printed] foo: 'a -> {h: 'a, t: nothing}
//│ fun bar: ‹∀ 0. bar96'#› where 
//│ |		α95' <: α97_101'
//│ |		bar96'# := (α97' -> α98')
//│ |		α97' <: α95'
//│ |		α98' :> {h: α95', t: α99'}
//│ |		α99' :> ‹∀ 1. α98_100''›
//│ [pretty-printed] bar: 'a -> {h: 'a, t: nothing}

:ns
foo
//│ Typed: forall 'a 'b 'foo 'c. 'foo
//│   where
//│     'foo := 'c -> {h: 'c, t: 'a}
//│     'a :> forall 'd. 'd
//│     'c <: 'b


fun foo(a) = {h1: a, t1: bar(a)}
fun bar(b) = {h2: b, t2: foo(b)}
//│ fun foo: ‹∀ 0. foo120'#› where 
//│ |		foo120'# := (α121' -> {h1: α121', t1: α125'})
//│ |		α121' <: α123_127'
//│ |		α125' :> ‹∀ 1. {h2: α123_127', t2: α124_128''}›
//│ [pretty-printed] foo: 'a -> {h1: 'a, t1: {h2: 'a, t2: nothing}}
//│ fun bar: ‹∀ 0. bar122'#› where 
//│ |		α121' <: α123_127'
//│ |		bar122'# := (α123' -> {h2: α123', t2: α124'})
//│ |		α123' <: α121'
//│ |		α124' :> {h1: α121', t1: α125'}
//│ |		α125' :> ‹∀ 1. {h2: α123_127', t2: α124_128''}›
//│ [pretty-printed] bar: 'a -> {h2: 'a, t2: {h1: 'a, t1: {h2: 'a, t2: nothing}}}

:ns
foo
//│ Typed: forall 'foo 'a 'b 'c. 'foo
//│   where
//│     'foo := 'a -> {h1: 'a, t1: 'b}
//│     'b :> forall 'd. {h2: 'c, t2: 'd}
//│     'a <: 'c



module Test0_1 {
  fun a = Test0_2.b
}
module Test0_2 {
  fun b = 123
}
//│ class Test0_1
//│   fun a: ‹∀ 1. a150''#› where 
//│   |		a150''# := b155''
//│   |		b154''# := 123<int,number>
//│   |		b155'' :> ‹∀ 1. b154''#› <: a150''#
//│   [pretty-printed] a: 123
//│ class Test0_2
//│   fun b: ‹∀ 1. b154''#› where 
//│   |		b154''# := 123<int,number>
//│   [pretty-printed] b: 123

Test0_1.a
//│ Typed: 123

class Test0_1 {
  fun a = Test0_2().b
}
class Test0_2() {
  fun b = 123
}
//│ class Test0_1
//│   fun a: ‹∀ 1. a172''#› where 
//│   |		a172''# := b179''
//│   |		b176''# := 123<int,number>
//│   |		b179'' :> ‹∀ 1. b176''#› <: a172''#
//│   [pretty-printed] a: 123
//│ class Test0_2
//│   fun b: ‹∀ 1. b176''#› where 
//│   |		b176''# := 123<int,number>
//│   [pretty-printed] b: 123


:e // TODO
module Test1_1 {
  fun a = Test1_2.b
}
module Test1_2 {
  fun b = Test1_1.a
}
//│ ╔══[ERROR] Cyclic definition
//│ ║  l.178: 	module Test1_1 {
//│ ║         	^^^^^^^^^^^^^^^^
//│ ║  l.179: 	  fun a = Test1_2.b
//│ ║         	^^^^^^^^^^^^^^^^^^^
//│ ║  l.180: 	}
//│ ╙──       	^
//│ class Test1_1
//│   fun a: ‹∀ 1. a190''#› where 
//│   |		a190''# := b196''
//│   |		b194''# := a195''
//│   |		a195'' :> error<> <: b194''#
//│   |		b196'' :> ‹∀ 1. b194''#› <: a190''#
//│   [pretty-printed] a: error
//│ class Test1_2
//│   fun b: ‹∀ 1. b194''#› where 
//│   |		b194''# := a195''
//│   |		a195'' :> error<> <: b194''#
//│   [pretty-printed] b: error

Test1_1.a
//│ Typed: error


:e // TODO
class Test1_1 {
  fun a = Test1_2().b
}
class Test1_2 {
  fun b = Test1_1().a
}
//│ ╔══[ERROR] Cyclic definition
//│ ║  l.209: 	class Test1_1 {
//│ ║         	^^^^^^^^^^^^^^^
//│ ║  l.210: 	  fun a = Test1_2().b
//│ ║         	^^^^^^^^^^^^^^^^^^^^^
//│ ║  l.211: 	}
//│ ╙──       	^
//│ class Test1_1
//│   fun a: ‹∀ 1. a216''#› where 
//│   |		a216''# := b225''
//│   |		b220''# := a222''
//│   |		a222'' :> error<> <: b220''#
//│   |		b225'' :> ‹∀ 1. b220''#› <: a216''#
//│   [pretty-printed] a: error
//│ class Test1_2
//│   fun b: ‹∀ 1. b220''#› where 
//│   |		b220''# := a222''
//│   |		a222'' :> error<> <: b220''#
//│   [pretty-printed] b: error


// TODO check TV hygiene
module Test2_1 {
  fun t2 = Test2_2
  fun a = Test2_2.b
  fun d = Test2_2.e
  fun n = 456
}
module Test2_2 {
  fun b = 123
  fun c = Test2_1.a
  fun e = Test2_1.n
}
//│ ╔══[ERROR] Cyclic definition
//│ ║  l.237: 	module Test2_1 {
//│ ║         	^^^^^^^^^^^^^^^^
//│ ║  l.238: 	  fun t2 = Test2_2
//│ ║         	^^^^^^^^^^^^^^^^^^
//│ ║  l.239: 	  fun a = Test2_2.b
//│ ║         	^^^^^^^^^^^^^^^^^^^
//│ ║  l.240: 	  fun d = Test2_2.e
//│ ║         	^^^^^^^^^^^^^^^^^^^
//│ ║  l.241: 	  fun n = 456
//│ ║         	^^^^^^^^^^^^^
//│ ║  l.242: 	}
//│ ╙──       	^
//│ ╔══[ERROR] Cyclic definition
//│ ║  l.237: 	module Test2_1 {
//│ ║         	^^^^^^^^^^^^^^^^
//│ ║  l.238: 	  fun t2 = Test2_2
//│ ║         	^^^^^^^^^^^^^^^^^^
//│ ║  l.239: 	  fun a = Test2_2.b
//│ ║         	^^^^^^^^^^^^^^^^^^^
//│ ║  l.240: 	  fun d = Test2_2.e
//│ ║         	^^^^^^^^^^^^^^^^^^^
//│ ║  l.241: 	  fun n = 456
//│ ║         	^^^^^^^^^^^^^
//│ ║  l.242: 	}
//│ ╙──       	^
//│ class Test2_1
//│   fun t2: ‹∀ 1. t2241''#› where 
//│   |		t2241''# := Test2_2<>
//│   [pretty-printed] t2: Test2_2
//│   fun a: ‹∀ 1. a252''#› where 
//│   |		b247''# := 123<int,number>
//│   |		a252''# := b253''
//│   |		b253'' :> ‹∀ 1. b247''#› <: a252''#
//│   [pretty-printed] a: 123
//│   fun d: ‹∀ 1. d257''#› where 
//│   |		e250''# := n251''
//│   |		n251'' :> error<> <: e250''#
//│   |		d257''# := e258''
//│   |		e258'' :> ‹∀ 1. e250''#› <: d257''#
//│   [pretty-printed] d: error
//│   fun n: ‹∀ 1. n262''#› where 
//│   |		n262''# := 456<int,number>
//│   [pretty-printed] n: 456
//│ class Test2_2
//│   fun b: ‹∀ 1. b247''#› where 
//│   |		b247''# := 123<int,number>
//│   [pretty-printed] b: 123
//│   fun c: ‹∀ 1. c248''#› where 
//│   |		c248''# := a249''
//│   |		a249'' :> error<> <: c248''#
//│   [pretty-printed] c: error
//│   fun e: ‹∀ 1. e250''#› where 
//│   |		e250''# := n251''
//│   |		n251'' :> error<> <: e250''#
//│   [pretty-printed] e: error

Test2_1.t2.b
//│ Typed: 123

Test2_1.a
//│ Typed: 123

// FIXME
Test2_1.d
//│ Typed: error

Test2_1.n
//│ Typed: 456

