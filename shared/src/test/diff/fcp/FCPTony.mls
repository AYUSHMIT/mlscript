:GeneralizeCurriedFunctions
:NoRecursiveTypes
:NoProvs
:ConstrainedTypes



def app n f = n f
//│ app: 'a -> (forall 'a, 'b, 'c. ('b -> 'c
//│   where
//│     'a <: 'b -> 'c))
//│    = [Function: app]

def g x y = app x y
//│ g: 'a -> (forall 'a, 'b, 'c. ('b -> 'c
//│   where
//│     'a <: 'b -> 'c))
//│  = [Function: g]

:e
g {} {}
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.21: 	g {} {}
//│ ║        	^^^^^^^
//│ ╟── record literal of type `anything` is not a function
//│ ║  l.21: 	g {} {}
//│ ║        	  ^^
//│ ╟── Note: constraint arises from application:
//│ ║  l.8: 	def app n f = n f
//│ ╙──     	              ^^^
//│ res: error
//│ Runtime error:
//│   TypeError: n is not a function



// ————————————————————————


def app p q = p q
//│ app: 'a -> (forall 'b, 'c, 'a. ('b -> 'c
//│   where
//│     'a <: 'b -> 'c))
//│    = [Function: app1]

def mul r s = r (app s) id
//│ mul: 'a -> (forall 'a, 'b, 'c. ('b -> 'c
//│   where
//│     'a <: (forall 'b, 'd, 'e. ('d -> 'e
//│   where
//│     'b <: 'd -> 'e)) -> (forall 'f. 'f -> 'f) -> 'c))
//│    = [Function: mul]

:e
mul id {}
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.55: 	mul id {}
//│ ║        	^^^^^^^^^
//│ ╟── record literal of type `anything` is not a function
//│ ║  l.55: 	mul id {}
//│ ║        	       ^^
//│ ╟── Note: constraint arises from application:
//│ ║  l.40: 	def app p q = p q
//│ ╙──      	              ^^^
//│ res: error
//│ Runtime error:
//│   TypeError: p is not a function

def fact t = mul t {}
//│ fact: ((forall 'a, 'b. ('a -> 'b
//│   where
//│     anything <: 'a -> 'b)) -> (forall 'c. 'c -> 'c) -> 'd) -> 'd
//│     = [Function: fact]

:e
fact id
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.76: 	fact id
//│ ║        	^^^^^^^
//│ ╟── record literal of type `anything` is not a function
//│ ║  l.69: 	def fact t = mul t {}
//│ ║        	                   ^^
//│ ╟── Note: constraint arises from application:
//│ ║  l.40: 	def app p q = p q
//│ ╙──      	              ^^^
//│ res: error
//│ Runtime error:
//│   TypeError: p is not a function

def mul r s = r (app s)
//│ mul: 'a -> (forall 'a, 'b, 'c. ('b -> 'c
//│   where
//│     'a <: (forall 'b, 'd, 'e. ('d -> 'e
//│   where
//│     'b <: 'd -> 'e)) -> 'c))
//│    = [Function: mul1]

mul id id {}
//│ res: anything
//│    = {}



// ————————————————————————


:ArgGen
:DistributeForalls


type ChurchInt = forall 'a. ('a -> 'a) -> ('a -> 'a)
//│ Defined type alias ChurchInt

def succ: ChurchInt -> ChurchInt
def succ n f x = f (n f x)
//│ succ: ChurchInt -> ChurchInt
//│     = <missing implementation>
//│ 'a -> (forall 'b. 'b -> (forall 'b, 'c, 'd. ('c -> 'd
//│   where
//│     'b <: (forall 'a, 'b, 'c, 'e. ('e
//│   where
//│     'a <: 'b -> 'c -> 'e)) -> 'd)))
//│   <:  succ:
//│ ChurchInt -> ChurchInt
//│     = [Function: succ1]

:ns
def add n m = n succ m
//│ add: forall 'a. 'a -> (forall 'b, 'c, 'd. ('c -> 'd
//│   where
//│     'a <: (ChurchInt -> ChurchInt) -> 'b))
//│   where
//│     'b <: 'c -> 'd
//│    = [Function: add]

// FIXME quantif of 'a
// :ds
add
//│ res: 'a -> (forall 'a, 'b, 'c. ('b -> 'c
//│   where
//│     'a <: (ChurchInt -> ChurchInt) -> 'b -> 'c))
//│    = [Function: add]

:ns
def f x y = add x y
//│ f: forall 'a. 'a -> (forall 'b, 'c, 'd, 'e, 'f. ('f -> 'b
//│   where
//│     'a <: (ChurchInt -> ChurchInt) -> 'e))
//│   where
//│     'f <: 'd
//│     'e <: 'd -> 'c
//│     'c <: 'b
//│  = [Function: f]

// :ds
f
//│ res: 'a -> (forall 'a, 'b, 'c. ('b -> 'c
//│   where
//│     'a <: (ChurchInt -> ChurchInt) -> 'b -> 'c))
//│    = [Function: f]

:e
f {} {}
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.163: 	f {} {}
//│ ║         	^^^^^^^
//│ ╟── record literal of type `anything` is not a function
//│ ║  l.163: 	f {} {}
//│ ║         	  ^^
//│ ╟── Note: constraint arises from application:
//│ ║  l.128: 	def add n m = n succ m
//│ ╙──       	              ^^^^^^
//│ res: error
//│ Runtime error:
//│   TypeError: n is not a function






