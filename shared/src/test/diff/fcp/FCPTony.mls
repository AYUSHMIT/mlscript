:GeneralizeCurriedFunctions
:NoRecursiveTypes
:NoProvs
// :ArgGen


def app n f = n f
//│ app: 'a -> (forall 'a, 'b, 'c. ('b -> 'c
//│   where
//│     'a <: 'b -> 'c))
//│    = [Function: app]

def g x y = app x y
//│ g: 'a -> (forall 'a, 'b, 'c, 'd, 'e. (('b & 'e) -> 'd
//│   where
//│     'a <: 'b -> ('c & 'd)))
//│  = [Function: g]

:e
g {} {}
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.20: 	g {} {}
//│ ║        	^^^^^^^
//│ ╟── record literal of type `anything` is not a function
//│ ║  l.20: 	g {} {}
//│ ║        	  ^^
//│ ╟── Note: constraint arises from application:
//│ ║  l.7: 	def app n f = n f
//│ ╙──     	              ^^^
//│ res: error
//│ Runtime error:
//│   TypeError: n is not a function



// ————————————————————————


def app p q = p q
//│ app: 'a -> (forall 'a, 'b, 'c. ('b -> 'c
//│   where
//│     'a <: 'b -> 'c))
//│    = [Function: app1]

def mul r s = r (app s) id
//│ mul: 'a -> (forall 'a. (('b & 'c) -> 'd
//│   where
//│     'a <: (forall 'b, 'e, 'f, 'g. ('e -> 'f | 'g
//│   where
//│     'b <: 'e -> 'f)) -> ((forall 'h. 'h -> 'h) -> 'd & 'i)))
//│    = [Function: mul]

:e
mul id {}
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.54: 	mul id {}
//│ ║        	^^^^^^^^^
//│ ╟── record literal of type `anything` is not a function
//│ ║  l.54: 	mul id {}
//│ ║        	       ^^
//│ ╟── Note: constraint arises from application:
//│ ║  l.39: 	def app p q = p q
//│ ╙──      	              ^^^
//│ res: error
//│ Runtime error:
//│   TypeError: p is not a function

def fact t = mul t {}
//│ fact: ((forall 'a, 'b, 'c. ('a -> 'b | 'c
//│   where
//│     anything <: 'a -> 'b)) -> ((forall 'd. 'd -> 'd) -> ('e & 'f) & 'g) & 'h & 'i) -> 'f
//│     = [Function: fact]

:e
fact id
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.75: 	fact id
//│ ║        	^^^^^^^
//│ ╟── record literal of type `anything` is not a function
//│ ║  l.68: 	def fact t = mul t {}
//│ ║        	                   ^^
//│ ╟── Note: constraint arises from application:
//│ ║  l.39: 	def app p q = p q
//│ ╙──      	              ^^^
//│ res: error
//│ Runtime error:
//│   TypeError: p is not a function

def mul r s = r (app s)
//│ mul: 'a -> (forall 'a. (('b & 'c) -> 'd
//│   where
//│     'a <: (forall 'b, 'e, 'f, 'g. ('e -> 'f | 'g
//│   where
//│     'b <: 'e -> 'f)) -> 'd))
//│    = [Function: mul1]

mul id id {}
//│ res: anything
//│    = {}



// ————————————————————————


:ArgGen
:DistributeForalls


type ChurchInt = forall 'a. ('a -> 'a) -> ('a -> 'a)
//│ Defined type alias ChurchInt

def succ: ChurchInt -> ChurchInt
def succ n f x = f (n f x)
//│ succ: ChurchInt -> ChurchInt
//│     = <missing implementation>
//│ 'a -> (forall 'b. 'b -> (forall 'b. ('c -> 'd
//│   where
//│     'b <: (forall 'a, 'b, 'c, 'e, 'f. ('e
//│   where
//│     'a <: 'b -> ('c -> 'e & 'f))) -> 'd)))
//│   <:  succ:
//│ ChurchInt -> ChurchInt
//│     = [Function: succ1]

def add n m = n succ m
def f x y = add x y
//│ add: 'a -> (forall 'a, 'b, 'c, 'd. ('b -> 'c
//│   where
//│     'a <: (ChurchInt -> ChurchInt) -> ('b -> 'c & 'd)))
//│    = [Function: add]
//│ f: 'a -> (forall 'a, 'b, 'c, 'd, 'e, 'f. (('b & 'f) -> 'd
//│   where
//│     'a <: (ChurchInt -> ChurchInt) -> ('b -> ('c & 'd) & 'e)))
//│  = [Function: f]

:e
f {} {}
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.138: 	f {} {}
//│ ║         	^^^^^^^
//│ ╟── record literal of type `anything` is not a function
//│ ║  l.138: 	f {} {}
//│ ║         	  ^^
//│ ╟── Note: constraint arises from application:
//│ ║  l.126: 	def add n m = n succ m
//│ ╙──       	              ^^^^^^
//│ res: error
//│ Runtime error:
//│   TypeError: n is not a function




