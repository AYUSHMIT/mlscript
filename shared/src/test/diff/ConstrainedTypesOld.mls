


// :d
foo x =
  log (succ x.prop)
//│ foo: {prop: int} -> unit
//│    = [Function: foo]

:ns
foo x =
  let _ = log (succ x.prop)
  in x
//│ foo: forall 'a, 'prop. 'a -> 'a
//│   where
//│     'a <: {prop: 'prop}
//│     'prop <: int
//│    = [Function: foo1]

:e
foo false
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.21: 	foo false
//│ ║        	^^^^^^^^^
//│ ╟── reference of type `false` does not have field 'prop'
//│ ║  l.21: 	foo false
//│ ║        	    ^^^^^
//│ ╟── Note: constraint arises from field selection:
//│ ║  l.12: 	  let _ = log (succ x.prop)
//│ ╙──      	                    ^^^^^^
//│ res: error
//│    = false
//│ output:
//│ NaN

foo x =
  let _ = log (fun y -> x.prop y)
  in x
//│ foo: ({prop: nothing -> anything} & 'a) -> 'a
//│    = [Function: foo2]

:e
foo false
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.43: 	foo false
//│ ║        	^^^^^^^^^
//│ ╟── reference of type `false` does not have field 'prop'
//│ ║  l.43: 	foo false
//│ ║        	    ^^^^^
//│ ╟── Note: constraint arises from field selection:
//│ ║  l.37: 	  let _ = log (fun y -> x.prop y)
//│ ╙──      	                        ^^^^^^
//│ res: error
//│    = false
//│ output:
//│ [Function (anonymous)]

foo x =
  let _ = log ((fun y -> x.prop y) 0)
  in x
//│ foo: ({prop: nothing -> anything & 0 -> anything} & 'a) -> 'a
//│    = [Function: foo3]

:e
foo false
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.65: 	foo false
//│ ║        	^^^^^^^^^
//│ ╟── reference of type `false` does not have field 'prop'
//│ ║  l.65: 	foo false
//│ ║        	    ^^^^^
//│ ╟── Note: constraint arises from field selection:
//│ ║  l.59: 	  let _ = log ((fun y -> x.prop y) 0)
//│ ╙──      	                         ^^^^^^
//│ res: error
//│ Runtime error:
//│   TypeError: x.prop is not a function

:ng
app = error : ('a -> 'a) -> ()
//│ app: ('a -> 'a) -> ()

:ng
foo x =
  let _ = app (fun y -> x.prop y)
  in x
//│ foo: ({prop: nothing -> anything & 'a -> 'a} & 'b) -> 'b

:e
foo false
//│ ╔══[ERROR] Type mismatch in application:
//│ ║  l.90: 	foo false
//│ ║        	^^^^^^^^^
//│ ╟── reference of type `false` does not have field 'prop'
//│ ║  l.90: 	foo false
//│ ║        	    ^^^^^
//│ ╟── Note: constraint arises from field selection:
//│ ║  l.85: 	  let _ = app (fun y -> x.prop y)
//│ ╙──      	                        ^^^^^^
//│ res: error
//│ Runtime error:
//│   TypeError: x.prop is not a function


