:AllowParseErrors
:AllowTypeErrors // TODO rm


if true then 1 else 2
//│ |#if| |true| |#then| |1| |#else| |2|
//│ Parsed: {if true then 1 else 2}

if a == 0
then "false" else 2
//│ |#if| |a| |==| |0|↵|#then| |"false"| |#else| |2|
//│ Parsed: {if a == 0 then "false" else 2}

if a == 0
then "false"
else 2
//│ |#if| |a| |==| |0|↵|#then| |"false"|↵|#else| |2|
//│ Parsed: {if a == 0 then "false" else 2}

if a == 0
  then "false"
  else 2
//│ |#if| |a| |==| |0|→|#then| |"false"|↵|#else| |2|
//│ Parsed: {if a == 0 then "false" else 2}

if a == 0
then "false"
  else 2
//│ |#if| |a| |==| |0|↵|#then| |"false"|→|#else| |2|
//│ Parsed: {if a == 0 then "false" else 2}

if a == 0
  then "false"
else 2
//│ |#if| |a| |==| |0|→|#then| |"false"|←|↵|#else| |2|
//│ Parsed: {if a == 0 then "false" else 2}

if a == 0
  then "false"
print of "ok!"
//│ |#if| |a| |==| |0|→|#then| |"false"|←|↵|print| |#of| |"ok!"|
//│ Parsed: {if a == 0 then "false"; print ("ok!",)}

if a == 0 then "false"
  else 2
print of "ok!"
//│ |#if| |a| |==| |0| |#then| |"false"|→|#else| |2|←|↵|print| |#of| |"ok!"|
//│ Parsed: {if a == 0 then "false" else 2; print ("ok!",)}

if
  true  then "true"
  false then "false"
//│ |#if|→|true| |#then| |"true"|↵|false| |#then| |"false"|
//│ Parsed: {if ‹true then "true"; false then "false"›}

if
  a == 1 then "true"
  b == 2 then "false"
//│ |#if|→|a| |==| |1| |#then| |"true"|↵|b| |==| |2| |#then| |"false"|
//│ Parsed: {if ‹a == 1 then "true"; b == 2 then "false"›}

if
  a == 0 then "false"
  a == 1 then "true"
//│ |#if|→|a| |==| |0| |#then| |"false"|↵|a| |==| |1| |#then| |"true"|
//│ Parsed: {if ‹a == 0 then "false"; a == 1 then "true"›}

if a ==
  0 then "false"
  1 then "true"
//│ |#if| |a| |==|→|0| |#then| |"false"|↵|1| |#then| |"true"|
//│ Parsed: {if a == ‹0 then "false"; 1 then "true"›}

if a ==
  0 then "false"
  _ then "true"
//│ |#if| |a| |==|→|0| |#then| |"false"|↵|_| |#then| |"true"|
//│ Parsed: {if a == ‹0 then "false"; _ then "true"›}

if a ==
  0 then "false"
  1 then "true"
  else "true"
//│ |#if| |a| |==|→|0| |#then| |"false"|↵|1| |#then| |"true"|↵|#else| |"true"|
//│ Parsed: {if a == ‹0 then "false"; 1 then "true"; else "true"›}

if a ==
  0 then "false"
  1 then "true"
else "true"
//│ |#if| |a| |==|→|0| |#then| |"false"|↵|1| |#then| |"true"|←|↵|#else| |"true"|
//│ Parsed: {if a == ‹0 then "false"; 1 then "true"› else "true"}

if a ==
    0 then "false"
    1 then "true"
  else "true"
//│ |#if| |a| |==|→|0| |#then| |"false"|↵|1| |#then| |"true"|←|→|#else| |"true"|
//│ Parsed: {if a == ‹0 then "false"; 1 then "true"› else "true"}

if a ==
  0 then "false" else "true"
//│ |#if| |a| |==|→|0| |#then| |"false"| |#else| |"true"|
//│ ╔══[ERROR] Expected deindentation; found 'else' keyword instead
//│ ║  l.102: 	  0 then "false" else "true"
//│ ║         	                 ^^^^
//│ ╟── Note: indented block starts here:
//│ ║  l.102: 	  0 then "false" else "true"
//│ ╙──       	^^
//│ ╔══[ERROR] Expected end of input; found literal instead
//│ ║  l.102: 	  0 then "false" else "true"
//│ ╙──       	                      ^^^^^^
//│ Parsed: {if a == ‹0 then "false"›}

if a
  > 0  then "false"
  == 1 then "true"
  _    then "true"
//│ |#if| |a|→|>| |0| |#then| |"false"|↵|==| |1| |#then| |"true"|↵|_| |#then| |"true"|
//│ ╔══[ERROR] Expected an expression; found a 'then'/'else' clause instead
//│ ║  l.117: 	  == 1 then "true"
//│ ╙──       	     ^^^^^^^^^^^^^
//│ ╔══[ERROR] Expected an expression; found a 'then'/'else' clause instead
//│ ║  l.116: 	  > 0  then "false"
//│ ║         	    ^^^^^^^^^^^^^^^
//│ ║  l.117: 	  == 1 then "true"
//│ ║         	^^^^^^^^^^^^^^^^^^
//│ ║  l.118: 	  _    then "true"
//│ ╙──       	^^^^^^^^^^^^^^^^^^
//│ ╔══[ERROR] Expected 'then'/'else' clause; found application followed by indentation instead
//│ ║  l.115: 	if a
//│ ║         	   ^
//│ ║  l.116: 	  > 0  then "false"
//│ ║         	^^^^^^^^^^^^^^^^^^^
//│ ║  l.117: 	  == 1 then "true"
//│ ║         	^^^^^^^^^^^^^^^^^^
//│ ║  l.118: 	  _    then "true"
//│ ║         	^^^^^^^^^^^^^^^^^^
//│ ╟── Note: 'if' expression started here:
//│ ║  l.115: 	if a
//│ ╙──       	^^
//│ ╔══[ERROR] Expected end of input; found indentation instead
//│ ║  l.117: 	  == 1 then "true"
//│ ║         	                  
//│ ║  l.118: 	  _    then "true"
//│ ╙──       	^^
//│ Parsed: {if > a undefined then undefined}

if a ==
  0 then "false"
  1 then "true"
else 2
//│ |#if| |a| |==|→|0| |#then| |"false"|↵|1| |#then| |"true"|←|↵|#else| |2|
//│ Parsed: {if a == ‹0 then "false"; 1 then "true"› else 2}

if a ==
  0 and b ==
    2 then "false"
    3 then "oops"
  1 then "true"
//│ |#if| |a| |==|→|0| |and| |b| |==|→|2| |#then| |"false"|↵|3| |#then| |"oops"|←|↵|1| |#then| |"true"|
//│ Parsed: {if a == ‹0 and b == ‹2 then "false"; 3 then "oops"›; 1 then "true"›}

if a is
  Some(x) then "defined"
  None    then "undefined"
//│ |#if| |a| |is|→|Some|(|x|)| |#then| |"defined"|↵|None| |#then| |"undefined"|
//│ Parsed: {if a is ‹Some (x,) then "defined"; None then "undefined"›}

if a is
  Some(x) and x is
    Left(a)  then "left-defined"
    Right(b) then "right-defined"
  None       then "undefined"
//│ |#if| |a| |is|→|Some|(|x|)| |and| |x| |is|→|Left|(|a|)| |#then| |"left-defined"|↵|Right|(|b|)| |#then| |"right-defined"|←|↵|None| |#then| |"undefined"|
//│ Parsed: {if a is ‹Some (x,) and x is ‹Left (a,) then "left-defined"; Right (b,) then "right-defined"›; None then "undefined"›}

// FIXME
if a is
  Some of x then "defined"
  None      then "undefined"
//│ |#if| |a| |is|→|Some| |#of| |x| |#then| |"defined"|↵|None| |#then| |"undefined"|
//│ ╔══[ERROR] Expected an expression; found a 'then'/'else' clause instead
//│ ║  l.180: 	  Some of x then "defined"
//│ ╙──       	          ^^^^^^^^^^^^^^^^
//│ Parsed: {if a is ‹Some (undefined,); None then "undefined"›}


if lol
//│ |#if| |lol|
//│ ╔══[ERROR] Expected 'then'/'else' clause; found reference instead
//│ ║  l.189: 	if lol
//│ ║         	   ^^^
//│ ╟── Note: 'if' expression started here:
//│ ║  l.189: 	if lol
//│ ╙──       	^^
//│ Parsed: {if lol then undefined}

if lol then
//│ |#if| |lol| |#then|
//│ ╔══[ERROR] Unexpected end of input; an expression was expected here
//│ ║  l.199: 	if lol then
//│ ╙──       	           
//│ Parsed: {if lol then undefined}

if lol then else
//│ |#if| |lol| |#then| |#else|
//│ ╔══[ERROR] Unexpected end of input; an expression was expected here
//│ ║  l.206: 	if lol then else
//│ ╙──       	                
//│ ╔══[ERROR] Expected an expression; found a 'then'/'else' clause instead
//│ ║  l.206: 	if lol then else
//│ ╙──       	            ^^^^
//│ Parsed: {if lol then undefined}

if lol
then
else
//│ |#if| |lol|↵|#then|↵|#else|
//│ ╔══[ERROR] Unexpected newline in expression position
//│ ║  l.217: 	then
//│ ║         	    
//│ ║  l.218: 	else
//│ ╙──       	
//│ ╔══[ERROR] Unexpected end of input; an expression was expected here
//│ ║  l.218: 	else
//│ ╙──       	    
//│ ╔══[ERROR] Expected an expression; found a 'then'/'else' clause instead
//│ ║  l.218: 	else
//│ ╙──       	^^^^
//│ Parsed: {if lol then undefined}

if lol else 2
//│ |#if| |lol| |#else| |2|
//│ ╔══[ERROR] Expected 'then'/'else' clause; found reference followed by 'else' keyword instead
//│ ║  l.233: 	if lol else 2
//│ ║         	   ^^^^^^^^
//│ ╟── Note: 'if' expression started here:
//│ ║  l.233: 	if lol else 2
//│ ╙──       	^^
//│ Parsed: {if lol then undefined else 2}


x = if true then false else maybe
//│ |x| |#=| |#if| |true| |#then| |false| |#else| |maybe|
//│ ╔══[ERROR] Unexpected '=' keyword in expression position
//│ ║  l.244: 	x = if true then false else maybe
//│ ╙──       	  ^
//│ ╔══[WARNING] Paren-less applications should use the 'of' keyword
//│ ║  l.244: 	x = if true then false else maybe
//│ ╙──       	^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//│ Parsed: {x (if true then false else maybe,)}

x =
  if true then
y = 1
//│ |x| |#=|→|#if| |true| |#then|←|↵|y| |#=| |1|
//│ ╔══[ERROR] Unexpected '=' keyword in expression position
//│ ║  l.254: 	x =
//│ ╙──       	  ^
//│ ╔══[ERROR] Unexpected deindentation in expression position
//│ ║  l.256: 	y = 1
//│ ╙──       	
//│ ╔══[ERROR] Unexpected newline in expression position
//│ ║  l.255: 	  if true then
//│ ║         	              
//│ ║  l.256: 	y = 1
//│ ╙──       	
//│ ╔══[ERROR] Unexpected '=' keyword in expression position
//│ ║  l.256: 	y = 1
//│ ╙──       	  ^
//│ ╔══[WARNING] Paren-less applications should use the 'of' keyword
//│ ║  l.256: 	y = 1
//│ ╙──       	^^^^^
//│ ╔══[WARNING] Paren-less applications should use the 'of' keyword
//│ ║  l.254: 	x =
//│ ║         	^^^
//│ ║  l.255: 	  if true then
//│ ║         	^^^^^^^^^^^^^^
//│ ║  l.256: 	y = 1
//│ ╙──       	^^^^^
//│ Parsed: {x ({if true then y (1,)},)}

if a ==
  0 and b ==
    2 then "false"
    else "1"
  1 then "true"
  else "2"
//│ |#if| |a| |==|→|0| |and| |b| |==|→|2| |#then| |"false"|↵|#else| |"1"|←|↵|1| |#then| |"true"|↵|#else| |"2"|
//│ Parsed: {if a == ‹0 and b == ‹2 then "false"; else "1"›; 1 then "true"; else "2"›}

else 1
//│ |#else| |1|
//│ ╔══[ERROR] Unexpected 'then'/'else' clause
//│ ║  l.293: 	else 1
//│ ╙──       	^^^^^^
//│ Parsed: {undefined}

1 else 2
//│ |1| |#else| |2|
//│ ╔══[ERROR] Expected end of input; found 'else' keyword instead
//│ ║  l.300: 	1 else 2
//│ ╙──       	  ^^^^
//│ Parsed: {1}


if a then if b then c else d
//│ |#if| |a| |#then| |#if| |b| |#then| |c| |#else| |d|
//│ Parsed: {if a then if b then c else d}

if a then if b then c else d else e
//│ |#if| |a| |#then| |#if| |b| |#then| |c| |#else| |d| |#else| |e|
//│ Parsed: {if a then if b then c else d else e}


if a is
  Left(x) then x
  let y = a + 1
  Right(0) then y
//│ |#if| |a| |is|→|Left|(|x|)| |#then| |x|↵|#let| |y| |#=| |a| |+| |1|↵|Right|(|0|)| |#then| |y|
//│ Parsed: {if a is ‹Left (x,) then x; let y = + a 1 in Right (0,) then y›}

if a is
  Some(v) and v is
    Left(x) then x
    let y = v + 1
    Right(0) then y
    Right(x) then x + y
  else 0
//│ |#if| |a| |is|→|Some|(|v|)| |and| |v| |is|→|Left|(|x|)| |#then| |x|↵|#let| |y| |#=| |v| |+| |1|↵|Right|(|0|)| |#then| |y|↵|Right|(|x|)| |#then| |x| |+| |y|←|↵|#else| |0|
//│ Parsed: {if a is ‹Some (v,) and v is ‹Left (x,) then x; let y = + v 1 in Right (0,) then y; Right (x,) then + x y›; else 0›}

if a is
  Some(x) and x is
    Left(a)  then "left-defined"
    let y = x + 1
    Right(b) then "right-defined"
  None       then "undefined"
//│ |#if| |a| |is|→|Some|(|x|)| |and| |x| |is|→|Left|(|a|)| |#then| |"left-defined"|↵|#let| |y| |#=| |x| |+| |1|↵|Right|(|b|)| |#then| |"right-defined"|←|↵|None| |#then| |"undefined"|
//│ Parsed: {if a is ‹Some (x,) and x is ‹Left (a,) then "left-defined"; let y = + x 1 in Right (b,) then "right-defined"›; None then "undefined"›}

// TODO improve error:
if a is
  Left x then x
//│ |#if| |a| |is|→|Left| |x| |#then| |x|
//│ ╔══[ERROR] Expected an expression; found a 'then'/'else' clause instead
//│ ║  l.345: 	  Left x then x
//│ ╙──       	       ^^^^^^^^
//│ ╔══[WARNING] Paren-less applications should use the 'of' keyword
//│ ║  l.345: 	  Left x then x
//│ ╙──       	  ^^^^^^^^^^^^^
//│ ╔══[ERROR] Expected 'then'/'else' clause; found application instead
//│ ║  l.344: 	if a is
//│ ║         	   ^^^^
//│ ║  l.345: 	  Left x then x
//│ ║         	^^^^^^^^^^^^^^^
//│ ╟── Note: 'if' expression started here:
//│ ║  l.344: 	if a is
//│ ╙──       	^^
//│ Parsed: {if is a {Left (undefined,)} then undefined}

if a is
  Left(x) then x
  let y = a + 1
  then y
//│ |#if| |a| |is|→|Left|(|x|)| |#then| |x|↵|#let| |y| |#=| |a| |+| |1|↵|#then| |y|
//│ ╔══[ERROR] Expected an expression; found a 'then'/'else' clause instead
//│ ║  l.365: 	  let y = a + 1
//│ ║         	          ^^^^^
//│ ║  l.366: 	  then y
//│ ╙──       	^^^^^^^^
//│ Parsed: {if a is ‹Left (x,) then x; let y = undefined in undefined›}



// --- // COMPARISONS // --- //

// Rust/Swift:
if let Some(x) = v then 123
//│ |#if| |#let| |Some|(|x|)| |#=| |v| |#then| |123|
//│ ╔══[ERROR] Expected '=' keyword; found opening parenthesis instead
//│ ║  l.380: 	if let Some(x) = v then 123
//│ ╙──       	           ^
//│ ╔══[ERROR] Expected 'then'/'else' clause; found let binding followed by closing parenthesis instead
//│ ║  l.380: 	if let Some(x) = v then 123
//│ ║         	            ^^
//│ ╟── Note: 'if' expression started here:
//│ ║  l.380: 	if let Some(x) = v then 123
//│ ╙──       	^^
//│ ╔══[ERROR] Expected end of input; found closing parenthesis instead
//│ ║  l.380: 	if let Some(x) = v then 123
//│ ╙──       	             ^
//│ Parsed: {if let Some = x in undefined then undefined}

// Swift:
if let Some(x) = v and cond then 123
//│ |#if| |#let| |Some|(|x|)| |#=| |v| |and| |cond| |#then| |123|
//│ ╔══[ERROR] Expected '=' keyword; found opening parenthesis instead
//│ ║  l.397: 	if let Some(x) = v and cond then 123
//│ ╙──       	           ^
//│ ╔══[ERROR] Expected 'then'/'else' clause; found let binding followed by closing parenthesis instead
//│ ║  l.397: 	if let Some(x) = v and cond then 123
//│ ║         	            ^^
//│ ╟── Note: 'if' expression started here:
//│ ║  l.397: 	if let Some(x) = v and cond then 123
//│ ╙──       	^^
//│ ╔══[ERROR] Expected end of input; found closing parenthesis instead
//│ ║  l.397: 	if let Some(x) = v and cond then 123
//│ ╙──       	             ^
//│ Parsed: {if let Some = x in undefined then undefined}

// MLscript:
if v is Some(x) and x is Left(y) then 123
//│ |#if| |v| |is| |Some|(|x|)| |and| |x| |is| |Left|(|y|)| |#then| |123|
//│ Parsed: {if v is Some (x,) and x is Left (y,) then 123}

// ML:
let Some(x) = v
//│ |#let| |Some|(|x|)| |#=| |v|
//│ ╔══[ERROR] Expected '=' keyword; found opening parenthesis instead
//│ ║  l.419: 	let Some(x) = v
//│ ╙──       	        ^
//│ ╔══[ERROR] Expected end of input; found closing parenthesis instead
//│ ║  l.419: 	let Some(x) = v
//│ ╙──       	          ^
//│ Parsed: {let Some = x in undefined}

v as Some(x)
//│ |v| |as| |Some|(|x|)|
//│ Parsed: {as v (Some (x,))}



